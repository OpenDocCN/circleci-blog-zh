<html>
<head>
<title>Deploying applications to Kubernetes from your CI pipeline with Shipa | CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Shipa | CircleCI从CI渠道向Kubernetes部署应用程序</h1>
<blockquote>原文：<a href="https://circleci.com/blog/deploying-apps-to-k8s-with-shipa/#2021-03-09T09:00:00-08:00">https://circleci.com/blog/deploying-apps-to-k8s-with-shipa/#2021-03-09T09:00:00-08:00</a></blockquote><div><div class="post-content col-xs-12 col-md-10 col-lg-8">
        

        <p>Kubernetes可以为开发组织带来一系列的优势。正确使用Kubernetes可以显著提高生产力，让您能够更好地利用您的云支出，并提高应用程序的稳定性和可靠性。另一方面，如果你没有很好地利用Kubernetes，你的潜在好处就会变成缺点。作为一名开发人员，当您关注于快速交付高质量的代码时，这可能会变得非常令人沮丧。以对象为中心的应用程序架构的学习曲线和管理、脚本编写、集成到多个CI系统和管道中，以及管理基础架构都会降低您的工作效率。根据Tidelift和New Stack 进行的<a href="https://thenewstack.io/how-much-time-do-developers-spend-actually-writing-code/">调查，开发人员只有32%的时间花在编写新代码或改进现有代码上。另外的68%花费在会议、代码维护、测试、安全问题等等。</a></p>

<p>如果开发人员能够充分利用Kubernetes的优势，同时避免其缺陷，会怎么样？在本教程中，我们将展示CircleCI和Shipa如何共同帮助团队从Kubernetes中获得最佳表现。它是如何工作的？CircleCI通过可定制的管道最大化速度，而<a href="https://www.shipa.io/"> Shipa </a>则简化了Kubernetes。这种结合让开发人员有更多的时间去做他们最擅长的事情:快速开发高质量的软件，而不改变他们的工作方式。您的平台工程团队可以管理、保护和交付一个强大的Kubernetes平台，使整个开发组织受益。</p>

<h2>先决条件</h2>
<p>对于本例，我们假设您有:</p>



<p><img src="../Images/3b520f2693466c3ad34ba4219f7b29ba.png" alt="CI pipeline with Shipa" srcset="https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2021-03-08-shipa1.png"/></p>

<h2>入门指南</h2>
<p>在本教程中，我们将使用CircleCI和<a href="https://circleci.com/developer/orbs/orb/shipa/shipa"> Shipa orb </a>向Kubernetes集群交付我们的应用程序。<a href="https://circleci.com/orbs/">orb</a>是可重用的代码片段，有助于自动化重复的过程，加速项目设置，并使其易于与Shipa等第三方工具集成。</p>

<p>本教程的应用程序源代码可从<a href="https://github.com/brunoa19/circleci-sample">这里</a>获得。</p>

<h2>在CircleCI上设置环境变量</h2>
<p>为了让CircleCI成功地连接到Shipa并通过CircleCI Shipa orb交付应用程序代码，我们需要在CircleCI项目中设置这些环境变量:</p>

<ul>
  <li>这是您的应用程序的名称。在管道运行之前，按照以下说明在Shipa上创建应用程序:https://learn . Shipa . io/docs/application # creating-an-application</li>
  <li><strong> SHIPA_CA </strong>这是您用来连接到SHIPA目标实例的客户端证书。您可以通过运行以下命令检索您的证书:</li>
</ul>

<pre><code>cat ~/.shipa/certificates/&lt;instance-name&gt;/ca.crt | base64
</code></pre>

<ul>
  <li>
    <p><strong> SHIPA_USER </strong>这是您用来登录SHIPA的用户名</p>
  </li>
  <li>
    <p><strong> SHIPA_PASSWORD </strong>这是您用来登录SHIPA的密码</p>
  </li>
  <li>
    <p><strong> SHIPA_SERVER </strong>这是SHIPA目标实例的地址。您可以通过运行以下命令来获取该地址:</p>
  </li>
</ul>

<pre><code>shipa target list
</code></pre>

<p>要定义这些<a href="https://circleci.com/docs/env-vars/#setting-an-environment-variable-in-a-project">环境变量</a>，请转到项目的设置页面。点击左侧栏中的<strong>环境变量</strong>，然后<strong>添加变量</strong>。</p>

<h2>建立Shipa</h2>
<p>对于本教程，您需要在Shipa 上创建一个<a href="https://learn.shipa.io/docs/application#creating-an-application">应用程序。更多信息参见</a><a href="https://learn.shipa.io/docs/setup">Shipa</a>入门。</p>

<p>这里有一个如何在Shipa上设置我们的应用程序的快速示例。</p>

<p>首先，我们在Shipa上启用Ruby平台，这样我们的示例Ruby代码就可以部署了:</p>

<pre><code>shipa platform add ruby
</code></pre>

<p>然后，我们创建将从CircleCI接收应用程序代码的应用程序:</p>

<pre><code>shipa app create circleci ruby -t shipa-admin-team -o shipa-pool
</code></pre>

<p>我们在示例项目中使用的应用程序名称是<code>circleci</code>，但是您可以给它起一个最适合您的名字。只要确保在<code>SHIPA_APP_NAME</code>变量中传递正确的名称。</p>

<h2>设置CircleCI管道</h2>
<p>使用CircleCI Shipa orb，我们将:</p>

<ul>
  <li>查看我们的应用程序代码</li>
  <li>设置Shipa</li>
  <li>通过Shipa部署应用程序</li>
</ul>

<p>对于CircleCI和Shipa orb来说，我们需要在名为<code>.circleci</code>的文件夹中创建一个<code>config.yml</code>文件。这是我们正在使用的<code>config.yml</code>。</p>

<pre><code># Use the latest 2.1 version of CircleCI pipeline process engine. See: https://circleci.com/docs/configuration-reference/
version: 2.1
# Use a package of configuration called an orb.
orbs:
  # Declare a dependency on the welcome-orb
  shipa: shipa/orb@0.6.0
# Orchestrate or schedule a set of jobs
jobs:
  shipa-deploy:
    executor: shipa/default
    steps:
      - checkout
      - shipa/install
      - shipa/app-deploy
workflows:
  # Name the workflow "welcome"
  welcome:
    # Run the welcome/run job in its own container
    jobs:
      - shipa-deploy
</code></pre>

<h2>使用Shipa部署</h2>
<p>现在我们需要运行CircleCI管道，并等待它完成。</p>

<p><img src="../Images/3d4d91b9bd0eb9d8f21c580aac6dc18f.png" alt="CircleCI dashboard with shipa-deploy job success" srcset="https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2021-03-08-shipa2.png"/></p>

<p>管道完成后，我们的应用程序就成功部署了，并且可以从Shipa CLI通过在您的终端中键入以下命令来使用:</p>

<pre><code>shipa app list
</code></pre>

<p>您还可以从Shipa仪表板上看到部署的应用程序。</p>

<p><img src="../Images/5be8a3ded8b43a4970ce462cefdb2514.png" alt="CircleCI dashboard with shipa-deploy job success" srcset="https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2021-03-08-shipa3.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2021-03-08-shipa3.png"/></p>

<p>从这里，开发者和运营商都可以访问与我们的<code>circleci</code>应用相关的大量信息，包括:</p>
<ul>
  <li>日志</li>
  <li>审计线索</li>
  <li>网络策略</li>
  <li>CNAME管理</li>
  <li>监控信息</li>
  <li>集成到事件管理工具中</li>
  <li>应用程序依赖关系图</li>
</ul>

<h2>结论</h2>
<p>使用Shipa orb与CircleCI集成，开发人员可以专注于应用程序代码，而开发人员和平台工程师可以专注于控件和护栏。</p>


        
          
          
        
      </div>
    </div>    
</body>
</html>
<html>
<head>
<title>Continuous Release with CircleCI and Houston - CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>CircleCI和休斯顿- CircleCI连续发布</h1>
<blockquote>原文：<a href="https://circleci.com/blog/continuous-release-with-circleci-and-houston/#2017-09-14T06:09:00-07:00">https://circleci.com/blog/continuous-release-with-circleci-and-houston/#2017-09-14T06:09:00-07:00</a></blockquote><div><div class="post-content col-xs-12 col-md-10 col-lg-8">
        
          <p class="italic"><strong>来自出版商的说明:</strong>您已经找到了我们的一些旧内容，这些内容可能已经过时和/或不正确。尝试在<a href="https://circleci.com/docs/" target="_blank">我们的文档</a>或<a href="https://circleci.com/blog/">博客</a>中搜索最新信息。</p>
          <hr/>
        

        <h2>将CircleCI、GKE和休斯顿结合起来，简单、安全、快速地将代码提供给客户。</h2>

<p><em>本文由Turbine Labs，Inc .首席执行官Mark McBride撰写</em></p>

<h3>概观</h3>

<p>工程团队的存在不是为了手动执行发布过程或紧张地盯着生产指标；他们的存在是为了制造并向客户交付产品。我们开发发布过程以确保我们构建的产品是好的，理解花费在这种保证上的时间是有代价的:花费在考虑发布上的时间就是花费在不考虑产品上的时间。在<a href="https://www.turbinelabs.io/">涡轮实验室</a>，我们花了很多时间思考如何改善这种平衡，这也是我们建造休斯顿的原因。在这里，我们将向您展示如何使用CircleCI、GKE和休斯顿的组合为web应用程序创建高质量、低开销的连续发布管道。</p>

<p>发布过程的目标是快速安全地将新代码提供给客户。在理想情况下，这一过程是即时的，没有风险。在现实世界中，<a href="https://blog.turbinelabs.io/every-release-is-a-production-test-b31d80f2bc74">每一次发布都伴随着一些风险</a>，所有的过程都需要时间。这是一种微妙的平衡。花太多时间来增加你对一个版本的信心，你的执行速度会慢得像爬行一样。过分热衷于发布，产品质量会受到影响，这也会使执行陷入停顿。</p>

<p>几十年前，代码/构建/验证/部署/发布周期被验证。这个过程中的大多数步骤都是由人来完成的，而且这个过程很慢。持续集成系统自动化单元测试和封装的兴起。最近，云和容器编排基础设施使得自动将代码推送到硬件变得前所未有的容易。<a href="https://blog.turbinelabs.io/deploy-not-equal-release-part-one-4724bc1e726b">但是正如我们已经看到的</a>，如果没有单独的发布流程，持续部署会增加客户面临的巨大风险。</p>

<p>传统发布流程中的压力和谨慎源于几个因素:</p>
<ol>
  <li>发布新代码的成本</li>
  <li>恢复失败版本的成本</li>
  <li>难以确定一个版本的质量</li>
  <li>发布缺陷的广泛范围</li>
</ol>

<p>正确的工具有助于建立一个工作流程来解决这些问题。执行成本低、恢复成本低、检查简单且影响有限的版本极大地加速了工程团队。</p>

<p>我们将通过一个具体的例子，使用CircleCI进行持续集成，<a href="https://cloud.google.com/container-engine/"> GKE </a>进行持续部署，以及<a href="https://www.turbinelabs.io/">休斯顿</a>进行高可信度发布。这个例子中的所有代码都可以在https://github.com/turbinelabs/circle-ci-integration/的<a href="https://github.com/turbinelabs/circle-ci-integration/">获得。您可以派生这个repo，并按照自述文件中的说明自己完成示例。</a></p>

<p><img src="../Images/f58a3e67a9b571a1c59f0dcf4e680618.png" alt="The release pipeline" srcset="https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/Turbine_thereleasepipeline.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/Turbine_thereleasepipeline.png"/></p>
<p align="center">释放管道</p>

<p>在我们的工作流中，开发人员推送由CircleCI构建、测试和打包的分支，circle ci会自动将它们作为部署推送到GKE。工程师可以在向广大受众发布之前测试这些部署，在生产中验证代码，而不会向客户公开。发布工程师推送标签，这些标签也由CircleCI打包，然后推送到GKE。这些部署可以增量地发布给客户，并与现有代码进行行为比较。如果新部署看起来不好，可以立即关闭。从git推送到代码出现在生产环境中的总时间大约是2分钟。</p>

<h3>GKE构型</h3>

<p>这个例子基于我们的<a href="https://docs.turbinelabs.io/guides/kubernetes.html"> Kubernetes集成指南</a>。我们在GKE部署了一个简单的服务，使用休斯顿来管理入口流量。这种设置允许我们将<a href="https://blog.turbinelabs.io/deploy-not-equal-release-part-one-4724bc1e726b">部署与</a>发布分开，支持增量蓝绿色部署、生产中的验证以及跨不同代码版本的应用行为的轻松比较。就其本身而言，这解决了我们的两个挑战:<a href="https://blog.turbinelabs.io/customer-centric-metrics-3acec880ae4d">休斯顿以客户为中心的方法来衡量应用健康</a>意味着它可以直接确定新代码是否表现良好，休斯顿的发布控制意味着<a href="https://blog.turbinelabs.io/beyond-observing-behavior-a0887fe0d3ca">恢复发布就像扳动开关一样简单</a>。</p>

<h3>要求</h3>

<p>我们希望它易于部署和发布代码，但我们不一定要将每个提交都推送到git。在本例中，我们使用以下约定:</p>

<ul>
  <li>
    <p>每次提交都有自动化测试运行。</p>
  </li>
  <li>
    <p>与/server-dev-命名方案匹配的分支。*/被推到GKE，每个分支都有自己的部署。当对分支进行修改时，相应的部署也会更新。这使得开发人员可以在不污染GKE环境的情况下迭代正在进行的分支。</p>
  </li>
  <li>
    <p>与/server-prod-命名方案匹配的标记。*/被推送到GKE，每个标签都有自己的部署。</p>
  </li>
</ul>

<p>CircleCI 2.0提供了<a href="https://circleci.com/docs/workflows/">工作流</a>，可以让您为不同的git活动编写不同的执行步骤。在我们的<a href="https://github.com/turbinelabs/circle-ci-integration/blob/master/.circleci/config.yml"> config.yml </a>中，我们定义了三个工作流:</p>

<ul>
  <li>
    <p>“构建”工作流在每次提交时执行，并且只运行自动化测试。</p>
  </li>
  <li>
    <p>“dev_deploy”工作流是在对匹配regex /server-dev-的分支进行更新时触发的。*/.它运行自动化测试，构建docker映像，将其推送到GCR，然后创建一个标有“开发”阶段的kubernetes部署。</p>
  </li>
  <li>
    <p>“prod_deploy”工作流在表单/server-prod-的标签推送时触发。*/.它像dev_deploy一样测试、打包和推送映像到GCR。但是，在创建部署之前，它还包括一个批准步骤，并将其部署标记为“生产”阶段。</p>
  </li>
</ul>

<p><img src="../Images/25b373c11ff9f18a03b2075a53255051.png" alt="Workflows in action" srcset="https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/Turbine_Workflows.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/Turbine_Workflows.png"/></p>
<p align="center">运行中的工作流</p>

<h3>连续累计</h3>

<p>我们的示例项目是一个简单的节点应用程序，因此集成只是执行一个自动化测试套件。CircleCI 2.0引入了使用定制容器映像的能力，通过允许用户从预先配置的映像开始，极大地缩短了构建/测试时间，从而节省了每次构建时下载和安装所需软件的成本。我们从正式的node:8.4.0映像开始，运行npm install和npm test，而不是从普通的Linux安装开始。</p>

<pre><code># note: the docker image versions here are almost certainly out of date.
# See https://github.com/turbinelabs/circle-ci-integration/blob/master/.circleci/config.yml
jobs:
  build:
    docker:
      - image: node:8.4.0
        environment:
          DEBIAN_FRONTEND: noninteractive
          steps:
            - checkout
            - run: cd server &amp;&amp; npm install &amp;&amp; npm test
</code></pre>

<h3>连续交货</h3>

<p>持续交付更加复杂，因为我们需要配置CircleCI来与GKE一起工作。我们使用项目环境变量来将秘密保存在我们的存储库中，设置以下值</p>

<ol>
  <li>GCLOUD_CLUSTER_NAME —可在GCLOUD容器集群列表中找到</li>
  <li>GCLOUD_COMPUTE_ZONE —也可以在GCLOUD容器集群列表中找到</li>
  <li>GCLOUD_PROJECT ID —此处描述了<a href="https://console.cloud.google.com/home/dashboard?pli=1"/></li>
  <li>谷歌地球</li>
</ol>

<p>为了避免每次构建都从一个新的Ubuntu映像开始，这需要每次构建都下载、安装和配置GCloudSDK和Docker，我们将它打包到一个映像<a href="https://github.com/turbinelabs/gcloud-build">中，这个映像</a>已经预装了软件，通过环境变量进行了配置。这在每次构建过程中节省了大量时间。有了这些，我们的推送开发服务器作业运行docker build，标记构建的映像，并将其推送到GCR。</p>

<pre><code># note: the docker image versions here are almost certainly out of date.
# See https://github.com/turbinelabs/circle-ci-integration/blob/master/.circleci/config.yml
  push-dev-server:
    docker:
      - image: turbinelabs/gcloud-build:0.12.0
    environment:
      DEBIAN_FRONTEND: noninteractive
    steps:
      - checkout
      - setup_remote_docker
      - run: openrc boot
      - run: docker build -t gcr.io/${GCLOUD_PROJECT_ID}/all-in-one-server:$CIRCLE_BRANCH server
      - run: docker tag gcr.io/${GCLOUD_PROJECT_ID}/all-in-one-server:$CIRCLE_BRANCH gcr.io/${GCLOUD_PROJECT_ID}/all-in-one-server:la
      - run: gcloud docker -- push gcr.io/${GCLOUD_PROJECT_ID}/all-in-one-server:$CIRCLE_BRANCH
</code></pre>

<h3>持续部署</h3>

<p>既然我们的代码已经打包并发送到GCR，我们就可以在GKE创建部署了。我们已经为开发和生产部署构建了yaml模板，替换了分支、标记、git sha、stage(开发或生产)和部署版本的字符串。一个简单的shell脚本使用CircleCI环境提供的信息将模板转换成有效的kubernetes规范。我们使用相同的gcloud-build-base映像来调用kubectl，我们的部署在GKE创建或更新。</p>

<pre><code>  ```
  # note: the docker image versions here are almost certainly out of date. # See https://github.com/turbinelabs/circle-ci-integration/blob/master/.circleci/config.yml   deploy-dev-server:
docker:
  - image: turbinelabs/gcloud-build:0.12.0
steps:
  - checkout
  - run: openrc boot
  - run: ./deploy.sh dev server/dev-deploy-template.yaml
  
 ```
</code></pre>

<p>请注意，这将<a href="https://blog.turbinelabs.io/deploy-not-equal-release-part-one-4724bc1e726b">部署代码，而不是发布代码</a>。</p>

<h3>在生产中验证</h3>

<p>现在我们的工作流已经就绪，我们可以创建一个开发分支，进行更改，推动它，并在大约2分钟内看到生产中的新部署。部署完成后，我们可以使用休斯顿来预览新的变更，并在它们发布给客户之前进行验证。为了简化这个过程，我们的前端开发人员创建了一个<a href="https://chrome.google.com/webstore/detail/houston-cookie-manager/bhigicedeaekhgjpgmpigofebngokpip?hl=en-US"> chrome插件</a>(源代码也可以从github 上的<a href="https://github.com/turbinelabs/houston-crx">获得)让你选择一个服务版本来查看。</a></p>

<p>我们首先将休斯顿配置为寻找名为“Tbn-All-in-one-server-Version”的cookie，如果这样的cookie存在，则将流量路由到版本标签与cookie值匹配的服务实例。有了它，我们的插件可以向休斯顿API请求一个已部署服务版本的列表，并设置一个cookie，将浏览器会话固定到该版本的代码。这让您可以与其他团队成员共享推送的代码，而没有干扰客户的风险。如果你需要改变，只需在你的分支上做出改变，然后推动它。CI管道构建、打包并推送新代码。</p>

<p><img src="../Images/caec61af75565508da854f9017f41974.png" alt="Select a deployed, but unreleased version of code to verify" srcset="https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/Turbine_verifycode.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/Turbine_verifycode.png"/></p>
<p align="center">选择已部署但未发布的代码版本进行验证</p>

<h3>放</h3>

<p>生产版本略有不同。当您想要创建一个可发布的版本时，创建一个标签并将其推送到您的git源。</p>

<pre><code>git tag server-prod-v1.1
git push origin server-prod-v1.1
</code></pre>

<p>这将触发CircleCI中的prod_deploy工作流。这遵循与dev_deploy工作流相同的步骤，但是在GKE中创建部署之前包括一个额外的批准步骤。这不是必需的，但是如果您希望在创建生产实例之前有一个轻量级的批准步骤，CircleCI提供了一个很好的解决方案。</p>

<p>创建部署后，您可以使用Houston向客户逐步发布新版本。从一个小的百分比开始，以最小化一个缺陷漏过的影响。然后，比较新旧版本的延迟和成功率。如果出现任何问题，只需关闭新版本，客户就会回到以前的版本。</p>

<p><img src="../Images/975c7c65a1177f3a370fbd0cb09e2dac.png" alt="Incremental blue green releases made easy" srcset="https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/Turbine_bluegreen.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/Turbine_bluegreen.png"/></p>
<p align="center">轻松实现蓝色/绿色增量发布</p>

<h3>包裹</h3>

<p>有了这条管道，我们可以轻松安全地构建、测试、部署、验证和发布软件。创建部署就像推送分支或标记一样简单。这些部署可以发布给单独的开发人员，或者逐渐地发布给用户群的一部分，极大地减少了缺陷的影响。当事故发生时，恢复到以前的状态就像按动电灯开关一样简单。所有这一切意味着工程团队花更少的时间强调做出改变，而更多的时间专注于构建产品。</p>


        
          
          
        
      </div>
    </div>    
</body>
</html>
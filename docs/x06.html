<html>
<head>
<title>Continuous integration for NestJS GraphQL projects | CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>NestJS GraphQL项目的持续集成| CircleCI</h1>
<blockquote>原文：<a href="https://circleci.com/blog/testing-nestjs-graphql/#2022-06-16T06:27:00-07:00">https://circleci.com/blog/testing-nestjs-graphql/#2022-06-16T06:27:00-07:00</a></blockquote><div><div class="post-content col-xs-12 col-md-10 col-lg-8">
        

        <blockquote>
  <p>本教程涵盖:</p>
  <ol>
    <li>克隆示例项目</li>
    <li>添加单元和集成测试</li>
    <li>自动化端到端测试</li>
  </ol>
</blockquote>

<p>NestJS正迅速成为NodeJS项目事实上的框架。与旧的框架不同，NestJS是用TypeScript构建的，这在JavaScript社区中已经很常见了。采用TypeScript的团队似乎更喜欢NestJS这样的框架。</p>

<p>NestJS支持在REST和GraphQL中构建API。作为REST的替代方案，<a href="https://graphql.org/" target="_blank" rel="noreferrer noopener"> GraphQL </a>允许您以完整而准确的方式描述数据，为更改客户端命令提供足够的灵活性。它为响应客户端查询返回数据提供了一个运行时。GraphQL提供了许多有用的开发工具，有助于简化API的维护。</p>

<p>本教程的目标是展示如何向NestJS GraphQL项目添加单元和集成测试，并使用CircleCI自动化测试过程。</p>

<h2>先决条件</h2>

<p>要完成本教程，您需要准备一些东西:</p>



<blockquote><p>我们的教程是平台无关的，但是使用CircleCI作为例子。如果你没有CircleCI账号，请在 注册一个免费的<a href="https://circleci.com/signup/"> <strong>。</strong></a></p></blockquote>

<h2>克隆一个示例项目</h2>

<p>本教程使用现有的NestJS应用程序。这是一个小的发票应用程序，演示了如何使用NestJS构建一个GraphQL API。</p>

<p>首先，克隆[ <a href="https://github.com/CIRCLECI-GWP/testing-nest-graphql" target="_blank" rel="noreferrer noopener">项目</a>。它已经包含了一些我将解释的测试。然后，我们将使用CircleCI自动化运行测试的过程。该项目有两个模块:客户和发票。每个模块包含一个服务和一个解析器文件。示例测试将集中在客户模块上。</p>

<h2>单元测试客户服务</h2>

<p>客服有三种方式:<code>create</code>、<code>findAll</code>、<code>findOne</code>。我们将为每个方法添加一个测试。<code>customer.service.spec.ts</code>文件已经包含了一个测试样板，我们可以用它来测试客户服务。在添加每个测试之前，您需要配置测试模块，为它提供所有必需的依赖项。测试配置被添加到<code>beforeEach</code>模块中。以下是客户服务的配置:</p>

<pre><code>// src/customer/customer.service.spec.ts

import { Test, TestingModule } from "@nestjs/testing";
import { getRepositoryToken } from "@nestjs/typeorm";
import { Repository } from "typeorm";
import { CustomerModel } from "./customer.model";
import { CustomerService } from "./customer.service";
type MockType&lt;T&gt; = {
  [P in keyof T]?: jest.Mock&lt;{}&gt;;
};
describe("CustomerService", () =&gt; {
  let service: CustomerService;
  const customerRepositoryMock: MockType&lt;Repository&lt;CustomerModel&gt;&gt; = {
    save: jest.fn(),
    findOne: jest.fn(),
    find: jest.fn(),
  };
  beforeEach(async () =&gt; {
    const module: TestingModule = await Test.createTestingModule({
      providers: [
        CustomerService,
        {
          provide: getRepositoryToken(CustomerModel),
          useValue: customerRepositoryMock,
        },
      ],
    }).compile();
    service = module.get&lt;CustomerService&gt;(CustomerService);
  });
});
</code></pre>

<p>有两个提供者:<code>CustomerService</code>和<code>CustomerRepository</code>。因为这是一个单元测试，我们对<code>CustomerRepository</code>使用了一个模拟值。以下是对每种方法的完整测试:</p>

<pre><code>// src/customer/customer.service.spec.ts

import { Test, TestingModule } from "@nestjs/testing";
import { getRepositoryToken } from "@nestjs/typeorm";
import { Repository } from "typeorm";
import { CustomerModel } from "./customer.model";
import { CustomerService } from "./customer.service";
type MockType&lt;T&gt; = {
  [P in keyof T]?: jest.Mock&lt;{}&gt;;
};
describe("CustomerService", () =&gt; {
  let service: CustomerService;
  const customerRepositoryMock: MockType&lt;Repository&lt;CustomerModel&gt;&gt; = {
    save: jest.fn(),
    findOne: jest.fn(),
    find: jest.fn(),
  };
  beforeEach(async () =&gt; {
    const module: TestingModule = await Test.createTestingModule({
      providers: [
        CustomerService,
        {
          provide: getRepositoryToken(CustomerModel),
          useValue: customerRepositoryMock,
        },
      ],
    }).compile();
    service = module.get&lt;CustomerService&gt;(CustomerService);
  });
  it("should be defined", () =&gt; {
    expect(service).toBeDefined();
  });
  describe("create", () =&gt; {
    it("should create a new customer", async () =&gt; {
      const customerDTO = {
        name: "John Doe",
        email: "john.doe@email.com",
        phone: "3134045867",
        address: "123 Road, Springfied, MO",
      };
      customerRepositoryMock.save.mockReturnValue(customerDTO);
      const newCustomer = await service.create(customerDTO);
      expect(newCustomer).toMatchObject(customerDTO);
      expect(customerRepositoryMock.save).toHaveBeenCalledWith(customerDTO);
    });
  });
  describe("findAll", () =&gt; {
    it("should find all customers", async () =&gt; {
      const customers = [
        {
          id: "1234",
          name: "John Doe",
          email: "john.doe@email.com",
          phone: "3134045867",
          address: "123 Road, Springfied, MO",
        },

        {
          id: "5678",
          name: "John Ford",
          email: "john.ford@email.com",
          phone: "3134045867",
          address: "456 Road, Springfied, MO",
        },
      ];
      customerRepositoryMock.find.mockReturnValue(customers);
      const foundCustomers = await service.findAll();
      expect(foundCustomers).toContainEqual({
        id: "1234",
        name: "John Doe",
        email: "john.doe@email.com",
        phone: "3134045867",
        address: "123 Road, Springfied, MO",
      });
      expect(customerRepositoryMock.find).toHaveBeenCalled();
    });
  });
  describe("findOne", () =&gt; {
    it("should find a customer", async () =&gt; {
      const customer = {
        id: "1234",
        name: "John Doe",
        email: "john.doe@email.com",
        phone: "3134045867",
        address: "123 Road, Springfied, MO",
      };
      customerRepositoryMock.findOne.mockReturnValue(customer);
      const foundCustomer = await service.findOne(customer.id);
      expect(foundCustomer).toMatchObject(customer);
      expect(customerRepositoryMock.findOne).toHaveBeenCalledWith(customer.id);
    });
  });
});
</code></pre>

<h3>测试客户解析程序</h3>

<p>还有测试解析器的样板代码:<code>customer.resolver.spec.ts</code>。解析器的测试类似于维修测试。我们将为<code>CustomerService</code>和<code>InvoiceService</code>依赖项提供模拟值。</p>

<pre><code>// src/customer/customer.resolver.spec.ts

import { Test, TestingModule } from "@nestjs/testing";
import { InvoiceService } from "../invoice/invoice.service";
import { CustomerDTO } from "./customer.dto";
import { CustomerResolver } from "./customer.resolver";
import { CustomerService } from "./customer.service";
const invoice = {
  id: "1234",
  invoiceNo: "INV-01",
  description: "GSVBS Website Project",
  customer: {},
  paymentStatus: "Paid",
  currency: "NGN",
  taxRate: 5,
  taxAmount: 8000,
  subTotal: 160000,
  total: 168000,
  amountPaid: "0",
  outstandingBalance: 168000,
  issueDate: "2017-06-06",
  dueDate: "2017-06-20",
  note: "Thank you for your patronage.",
  createdAt: "2017-06-06 11:11:07",
  updatedAt: "2017-06-06 11:11:07",
};
describe("CustomerResolver", () =&gt; {
  let resolver: CustomerResolver;
  beforeEach(async () =&gt; {
    const module: TestingModule = await Test.createTestingModule({
      providers: [
        CustomerResolver,
        {
          provide: CustomerService,
          useFactory: () =&gt; ({
            create: jest.fn((customer: CustomerDTO) =&gt; ({
              id: "1234",
              ...customer,
            })),
            findAll: jest.fn(() =&gt; [
              {
                id: "1234",
                name: "John Doe",
                email: "john.doe@email.com",
                phone: "3134045867",
                address: "123 Road, Springfied, MO",
              },

              {
                id: "5678",
                name: "John Ford",
                email: "john.ford@email.com",
                phone: "3134045867",
                address: "456 Road, Springfied, MO",
              },
            ]),
            findOne: jest.fn((id: string) =&gt; ({
              id: id,
              name: "John Doe",
              email: "john.doe@email.com",
              phone: "3134045867",
              address: "123 Road, Springfied, MO",
            })),
          }),
        },
        {
          provide: InvoiceService,
          useFactory: () =&gt; ({
            findByCustomer: jest.fn((id: string) =&gt; invoice),
          }),
        },
      ],
    }).compile();
    resolver = module.get&lt;CustomerResolver&gt;(CustomerResolver);
  });
  it("should be defined", () =&gt; {
    expect(resolver).toBeDefined();
  });
  describe("customer", () =&gt; {
    it("should find and return a customer", async () =&gt; {
      const customer = await resolver.customer("1234");
      expect(customer).toEqual({
        id: "1234",
        name: "John Doe",
        email: "john.doe@email.com",
        phone: "3134045867",
        address: "123 Road, Springfied, MO",
      });
    });
  });
  describe("customers", () =&gt; {
    it("should find and return a list of customers", async () =&gt; {
      const customers = await resolver.customers();
      expect(customers).toContainEqual({
        id: "1234",
        name: "John Doe",
        email: "john.doe@email.com",
        phone: "3134045867",
        address: "123 Road, Springfied, MO",
      });
    });
  });
  describe("invoices", () =&gt; {
    it("should find and return a customer invoice", async () =&gt; {
      const customer = await resolver.invoices({ id: "1234" });
      expect(customer).toEqual(invoice);
    });
  });
  describe("createCustomer", () =&gt; {
    it("should find and return a customer invoice", async () =&gt; {
      const customer = await resolver.createCustomer(
        "John Doe",
        "john.doe@email.com",
        "3134045867",
        "123 Road, Springfied, MO"
      );
      expect(customer).toEqual({
        id: "1234",
        name: "John Doe",
        email: "john.doe@email.com",
        phone: "3134045867",
        address: "123 Road, Springfied, MO",
      });
    });
  });
});
</code></pre>

<h2>自动化端到端测试</h2>

<p>端到端测试不使用模拟值，因为目标是测试每个组件(模型、解析器和服务),并确保它们一起正常工作。</p>

<p>测试数据库的TypeORM配置与主数据库的配置略有不同。我创建了一个<code>config</code>并添加了一个<code>config.database.ts</code>来基于环境(测试或开发)导出TypeORM配置。</p>

<pre><code>import dotenv from "dotenv";
dotenv.config();
const database = {
  development: {
    type: "postgres",
    host: "localhost",
    port: 5432,
    username: "godwinekuma",
    password: "",
    database: "invoiceapp",
    entities: ["dist/**/*.model.js"],
    synchronize: false,
    uuidExtension: "pgcrypto",
  },
  test: {
    type: "postgres",
    host: "localhost",
    port: 5432,
    username: process.env.POSTGRES_USER,
    password: "",
    database: process.env.POSTGRES_DB,
    entities: ["src/**/*.model.ts"],
    synchronize: true,
    dropSchema: true,
    migrationsRun: false,
    migrations: ["src/database/migrations/*.ts"],
    cli: {
      migrationsDir: "src/database/migrations",
    },
    keepConnectionAlive: true,
    uuidExtension: "pgcrypto",
  },
};
const DatabaseConfig = () =&gt; ({
  ...database[process.env.NODE_ENV],
});
export = DatabaseConfig;
</code></pre>

<p>注意<code>dropSchema</code>被设置为<code>true</code>；这将在测试后删除您的数据，以便将它们与之前的测试和运行隔离开来。在每次测试运行之后，删除连接中注册的每个实体的所有数据是一个很好的做法。在测试文件夹中创建一个<code>connection.ts</code>文件，并添加以下代码:</p>

<pre><code>// /test/connection.ts
import { createConnection, getConnection } from "typeorm";

const connection = {
  async create() {
    await createConnection();
  },

  async close() {
    await getConnection().close();
  },

  async clear() {
    const connection = getConnection();
    const entities = connection.entityMetadatas;

    const entityDeletionPromises = entities.map((entity) =&gt; async () =&gt; {
      const repository = connection.getRepository(entity.name);
      await repository.query(`DELETE FROM ${entity.tableName}`);
    });
    await Promise.all(entityDeletionPromises);
  },
};
export default connection;
</code></pre>

<p><code>connection</code>导出两个方法<code>close</code>和<code>clear</code>。为了关闭到数据库的连接，在所有的测试都被执行之后，调用<code>close</code>。在每次测试之前，<code>clear</code>被调用以在下一次测试运行之前删除所有数据。</p>

<p>添加测试:</p>

<pre><code>// /test/customer.e2e-spec.ts

import { Test, TestingModule } from "@nestjs/testing";
import { INestApplication } from "@nestjs/common";
import request = require("supertest");
import { AppModule } from "../src/app.module";
import connection from "./connection";
import { getConnection } from "typeorm";
import { CustomerModel } from "../src/customer/customer.model";

describe("CustomerResolver (e2e)", () =&gt; {
  let app: INestApplication;

  beforeEach(async () =&gt; {
    const moduleFixture: TestingModule = await Test.createTestingModule({
      imports: [AppModule],
    }).compile();

    app = moduleFixture.createNestApplication();
    await connection.clear();
    await app.init();
  });

  afterAll(async () =&gt; {
    await connection.close();
    await app.close();
  });

  const gql = "/graphql";

  describe("createCustomer", () =&gt; {
    it("should create a new customer", () =&gt; {
      return request(app.getHttpServer())
        .post(gql)
        .send({
          query:
            'mutation {createCustomer(name: "John Doe", email: "john.doe@example.com", phone: "145677312965", address: "123 Road, Springfied, MO") {address name phone email}}',
        })
        .expect(200)
        .expect((res) =&gt; {
          expect(res.body.data.createCustomer).toEqual({
            name: "John Doe",
            email: "john.doe@example.com",
            phone: "145677312965",
            address: "123 Road, Springfied, MO",
          });
        });
    });

    it("should get a single customer by id", () =&gt; {
      let customer;
      return request(app.getHttpServer())
        .post(gql)
        .send({
          query:
            'mutation {createCustomer(name: "John Doe", email: "john.doe@example.com", phone: "145677312965", address: "123 Road, Springfied, MO") {address name id phone email}}',
        })
        .expect(200)
        .expect((res) =&gt; {
          customer = res.body.data.createCustomer;
        })
        .then(() =&gt;
          request(app.getHttpServer())
            .post(gql)
            .send({
              query: `{customer(id: "${customer.id}") {address name id phone email}}`,
            })
            .expect(200)
            .expect((res) =&gt; {
              expect(res.body.data.customer).toEqual({
                id: customer.id,
                address: customer.address,
                name: customer.name,
                phone: customer.phone,
                email: customer.email,
              });
            })
        );
    });

    it("should retrieve all customer data", async () =&gt; {
      const data = [
        {
          name: "John Doe",
          email: "john.doe@example.com",
          phone: "145677312965",
          address: "123 Road, Springfied, MO",
        },
        {
          name: "Jane Doe",
          email: "jane.doe@example.com",
          phone: "145677312900",
          address: "456 Road, Springfied, MO",
        },
      ];
      const connection = await getConnection();
      data.map(async (item) =&gt; {
        await connection
          .createQueryBuilder()
          .insert()
          .into(CustomerModel)
          .values(item)
          .execute();
      });

      request(app.getHttpServer())
        .post(gql)
        .send({
          query: `{customers() {address name phone email}}`,
        })
        .expect(200)
        .expect((res) =&gt; {
          expect(res.body.data.customers.length).toEqual(data.length);
          expect(res.body.data.customers[0]).toEqual(data[0]);
        });
    });
  });
});
</code></pre>

<h2>将CircleCI配置添加到项目</h2>

<p>要开始自动化您的测试，您首先需要构建一个CircleCI将运行的持续集成管道。管道将:</p>

<ul>
  <li>检查您的存储库</li>
  <li>恢复现有缓存</li>
  <li>安装项目依赖项</li>
  <li>保存缓存</li>
  <li>运行单元测试</li>
  <li>运行端到端测试</li>
</ul>

<p>首先，在项目的根目录下创建一个名为<code>.circleci</code>的文件夹。在其中创建一个名为<code>config.yml</code>的文件。现在将这段代码粘贴到里面:</p>

<pre><code>version: 2.1
workflows:
  build:
    jobs:
      - test
jobs:
  test:
    docker:
      - image: cimg/node:10.23
      - image: cimg/postgres:10.17
        environment:
          POSTGRES_USER: circleci
          POSTGRES_DB: circleci
          POSTGRES_HOST_AUTH_METHOD: "trust"
    environment:
      NODE_ENV: test
      POSTGRES_USER: circleci
      POSTGRES_DB: circleci
      POSTGRES_HOST_AUTH_METHOD: "trust"
    steps:
      - run:
          name: Waiting for Postgres to be ready
          command: dockerize -wait tcp://localhost:5432 -timeout 1m
      - checkout
      - restore_cache:
          key: v1-deps-{{ checksum "package.json" }}
      - run: yarn install
      - save_cache:
          paths:
            - node_modules
          key: v1-deps-{{ checksum "package.json" }}
      - run: yarn test
      - run: yarn test:e2e
</code></pre>

<p>这个脚本指定Docker作为执行环境。它将导入两个CircleCI Docker映像，一个用于Nodejs，另一个用于Postgres。运行端到端测试需要Postgres。</p>

<p>提交您的代码并<a href="https://circleci.com/blog/pushing-a-project-to-github/">将其推送到您的repo </a>。</p>

<p>接下来，将项目设置为在推送代码更改时在CircleCI上运行。</p>

<h2>将项目连接到CircleCI</h2>

<p>转到CircleCI项目仪表板。如果你用GitHub或Bitbucket注册了CircleCI，你所有的库都会在那里列出。点击教程项目的<strong>设置项目</strong>按钮。</p>

<p><img src="../Images/9e7ee9dafc58b4cd7bfeb1f0aefffabc.png" alt="CircleCI project dashboard" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-06-16-circleci-project-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-06-16-circleci-project-dashboard.png"/></p>

<p>出现提示时，点击<strong> Let's go </strong>。您的项目将连接到Circle CI，并且您的第一个构建将开始运行。</p>

<p><img src="../Images/edb89c5ab617ff4cea395b598d1c6aee.png" alt="Select CircleCI confiq file" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-06-16-select-config-file.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-06-16-select-config-file.png"/></p>

<p>您的构建应该会成功运行。</p>

<p><img src="../Images/eea3c863568334b4424254741cf6a5cd.png" alt="Project Pipeline overview" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-06-16-project-pipeline-view.png"/></p>

<p>单击build链接查看管道如何运行，并确认测试成功通过。</p>

<p><img src="../Images/422db1d052681a1a495ffcca9c895d25.png" alt="Project pipeline detail" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-06-16-project-pipeline-detail.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-06-16-project-pipeline-detail.png"/></p>

<h2>结论</h2>

<p>在本教程中，我们使用customer模块向您展示了如何在NestJS GraphQL API中执行单元测试和端到端测试。这里使用的相同方法可以应用于示例应用程序中的其他模块，或者任何NestJS应用程序。与您的团队合作，尝试对您的NestJS和GraphQL应用程序进行自动化测试。</p>

<p>如果你有兴趣了解app是如何构建的，可以参考这篇帖子:<a href="https://blog.logrocket.com/how-to-build-a-graphql-api-with-nestjs/" target="_blank" rel="noreferrer noopener">如何用NestJS </a>构建GraphQL API。</p>


        
          
          
        
      </div>
    </div>    
</body>
</html>
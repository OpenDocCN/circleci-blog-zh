<html>
<head>
<title>Parallelized, visual testing with the Percy orb | CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Percy orb | CircleCI进行并行可视化测试</h1>
<blockquote>原文：<a href="https://circleci.com/blog/seamless-parallelized-visual-testing-with-the-percy-circleci-orb/#2018-12-06T05:13:00-08:00">https://circleci.com/blog/seamless-parallelized-visual-testing-with-the-percy-circleci-orb/#2018-12-06T05:13:00-08:00</a></blockquote><div><div class="post-content col-xs-12 col-md-10 col-lg-8">
        

        <p>我们在<a href="https://percy.io/"> Percy </a>的目标是帮助团队满怀信心地部署他们的应用程序，使其看起来完全符合预期。</p>

<p>我们的视觉测试和审查解决方案会自动为您检查UI，而不是在浏览器和屏幕之间手动检查。<a href="https://docs.percy.io/v1/docs/supported-frameworks">将Percy </a>与您的测试相集成，我们定制的渲染基础设施会在您每次进行更改时生成您的用户界面快照。</p>

<p>该工作流可以无缝地融入您现有的CI/CD套件中，帮助您消除每次提交时出现视觉倒退的风险。借助Percy，您还可以在并行CI构建的同时运行可视化测试——而我们的CircleCI orb让这变得前所未有的简单。</p>



<h2>珀西·切尔莱西球体</h2>

<p>因为Percy在CI服务的下游运行，所以它需要一个清晰的信号来指示构建何时完成，这样它就知道何时拥有完整的快照集。我们的orb 确保没有一个迟到的测试者没有完成。</p>

<p>Percy Orb的典型工作流程如下:</p>

<p><img src="../Images/c86b2a80dcc0a9580ba1a25de49b26c1.png" alt="parallel builds on circleci" srcset="https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/parallel_builds_on_circleci.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/parallel_builds_on_circleci.png"/></p>

<p>您的测试套件开始了，将运行测试的工作分成多个测试运行程序。一旦它们都完成了，就调用<code>percy/finalize_all</code>命令，触发完成一个构建并将构建中的所有快照视为已接收。</p>

<h2>环境变量</h2>

<p>一旦您创建了一个与CircleCI集成的Percy项目，请在您的项目设置下检索您的PERCY_TOKEN。</p>

<p>将<code>PERCY_PARALLEL_TOTAL</code>设置为-1。这告诉Percy，我们不知道这次运行的并行化程度如何，但是当我们听到来自orb的<code>percy/finalize_all</code>命令时，我们将认为我们的Percy构建已经完全完成。</p>

<h2>工作流配置</h2>

<p>您的CircleCI工作流配置导入了<code>percy/agent</code> orb，一旦所有测试完成，它就执行<code>percy/finalize_all</code>命令。</p>

<p>概括地说，<code>.circleci/config.yml</code>文件应该是这样的:</p>

<pre><code class="language-yaml">version: 2.1

orbs:
 percy: percy/agent@volatile

jobs:
 run_tests:
   steps:
     - attach_workspace:
         at: .
     - run: echo "your tests run here"

workflows:
 test:
   jobs:
     - run_tests:
         parallelism: 3
     - percy/finalize_all:
         requires:
           - run_tests
</code></pre>

<h2>运行测试</h2>

<p>一旦您将Percy CircleCI Orb添加到您的配置文件(<code>.circleci/config.yml</code>)中，每当您的测试运行时，快照将跨浏览器和屏幕尺寸呈现。</p>

<video autoplay="" loop="" muted="" playsinline="">
  <source src="/blog/media/2018-12-06-diff-min.mp4" type="video/mp4"/>
</video>

<p>在上面的例子中，发生变化的像素以红色“视觉差异”突出显示<a href="https://docs.percy.io/v1/docs/supported-frameworks"> Percy的SDK</a>使得向任何前端框架、测试框架、组件库或风格指南添加可视化测试变得容易。关于将我们的orb整合到你的CircleCI配置文件中的更多信息，请访问<a href="https://docs.percy.io/v1/docs/circleci-orb-integration"> Percy docs </a>。</p>

<p>我们很高兴成为CircleCI <a href="https://circleci.com/blog/announcing-orbs-technology-partner-program/">的技术合作伙伴</a>，使视觉测试更加高效和可扩展，我们期待着为未来的用例发展我们的Orb。</p>

<p>在2019年1月22日星期二上午10:00 PST/18:00 UTC举行的我们的<a href="https://www2.circleci.com/CircleCI-Percy-Webinar.html">网络研讨会</a>“Percy和CircleCI orbs在您的CI/CD工作流程中的视觉测试”中，了解更多关于CircleCI和Percy的信息</p>

<hr/>

<p>大卫·琼斯是珀西T2公司的工程总监。他喜欢与工程师一起工作，开发工具，让他们在发布软件时更有信心。你可以跟着他<a href="https://twitter.com/d_jones?lang=en"> @d_jones </a>。</p>



        
          
          
        
      </div>
    </div>    
</body>
</html>
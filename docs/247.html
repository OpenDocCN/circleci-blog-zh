<html>
<head>
<title>Deploying web applications on Kubernetes with continuous integration | CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>通过持续集成在Kubernetes上部署web应用程序| CircleCI</h1>
<blockquote>原文：<a href="https://circleci.com/blog/deploy-web-apps-on-kubernetes-with-ci/#2022-07-29T09:00:00-07:00">https://circleci.com/blog/deploy-web-apps-on-kubernetes-with-ci/#2022-07-29T09:00:00-07:00</a></blockquote><div><div class="post-content col-xs-12 col-md-10 col-lg-8">
        

        <blockquote>
  <p>本教程涵盖:</p>
  <ol>
    <li>使用circleci orbs创建持续集成管道</li>
    <li>将代码推送到repo后触发管道</li>
    <li>在Azure Kubernetes服务上部署Node.js应用程序</li>
  </ol>
</blockquote>

<p>容器和微服务彻底改变了应用程序在云上的部署方式。自2014年推出以来，<a href="https://kubernetes.io/" target="_blank" rel="noreferrer noopener"> Kubernetes </a>已经成为容器编排工具的事实标准。</p>

<p>在本教程中，您将学习如何使用<a href="https://circleci.com/continuous-integration/">持续集成和持续部署(CI/CD) </a>在<a href="https://azure.microsoft.com/en-us/services/kubernetes-service/#overview" target="_blank" rel="noreferrer noopener"> Azure Kubernetes服务</a> (AKS)上部署<a href="https://nodejs.org/" target="_blank" rel="noreferrer noopener"> Node.js </a>应用程序。您将使用<a href="https://circleci.com/orbs/"> CircleCI orbs </a>创建一个CI/CD管道，它们是<a href="https://circleci.com/blog/what-is-yaml-a-beginner-s-guide/"> YAML </a>配置的可重用包，将重复的配置片段压缩到一行代码中。在您推送<a href="https://github.com/" target="_blank" rel="noreferrer noopener"> GitHub </a>资源库中的代码后，您的管道将被自动触发。使用这种自动化，您将始终拥有在Kubernetes集群上运行的最新版本的应用程序。</p>

<h2>先决条件</h2>

<p>要跟随本教程，您首先需要一些东西:</p>



<p>完成所有先决条件后，您可以进入下一部分。</p>

<h2>克隆Node.js应用程序</h2>

<p>在本教程中，您主要关注的是在Kubernetes上部署应用程序。因此，您可以直接<a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/cloning-a-repository" target="_blank" rel="noreferrer noopener">将<a href="https://github.com/Lucifergene/aks-nodejs-deploy" target="_blank" rel="noreferrer noopener"> Node.js应用程序</a>克隆</a>到您的GitHub，并继续剩余的过程。</p>

<p>要克隆项目，请运行:</p>

<pre><code class="language-bash">git clone https://github.com/CIRCLECI-GWP/nodejs-aks-deploy.git 
</code></pre>

<p>这个存储库包含Node.js应用程序代码以及我们将在本教程中创建的所有YAML文件。</p>

<p>Node.js应用程序位于<code>app.js</code>文件中。</p>

<pre><code class="language-js">const express = require("express");
const path = require("path");
const morgan = require("morgan");
const bodyParser = require("body-parser");

/* eslint-disable no-console */

const port = process.env.PORT || 1337;
const app = express();

app.use(morgan("dev"));
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: "true" }));
app.use(bodyParser.json({ type: "application/vnd.api+json" }));

app.use(express.static(path.join(__dirname, "./")));

app.get("*", (req, res) =&gt; {
  res.sendFile(path.join(__dirname, "./index.html"));
});

app.listen(port, (err) =&gt; {
  if (err) {
    console.log(err);
  } else {
    console.log(`App at: http://localhost:${port}`);
  }
});
module.exports = app;
</code></pre>

<p>这段代码的关键是应用程序将要运行的<strong>端口号</strong>，也就是<code>1337</code>。</p>

<p>通过首先安装依赖项，您可以在本地运行应用程序。在项目的根目录中，键入:</p>

<pre><code class="language-bash">npm install
</code></pre>

<p>然后使用以下命令运行应用程序:</p>

<pre><code class="language-bash">node app.js
</code></pre>

<p>应用程序现在应该在地址<code>http://localhost:1337</code>启动并运行。</p>

<p>现在，在你的GitHub帐户上为这个项目创建一个新的存储库，并将项目推送到你刚刚创建的存储库中。</p>

<h2>容器化Node.js应用程序</h2>

<p>要将应用程序部署到Kubernetes，您必须首先<a href="https://circleci.com/blog/benefits-of-containerization/">容器化</a>它。使用Docker作为容器运行时工具，创建一个<a href="https://docs.docker.com/engine/reference/builder/">Docker文件</a>。Dockerfile是一个文本文档，它包含用户可以在命令行上调用的所有命令来组合一个图像。</p>

<p>在项目的根目录下创建一个新文件，命名为<code>Dockerfile</code>。复制文件中的以下内容:</p>

<pre><code class="language-yaml"># Set the base image to use for subsequent instructions
FROM node:alpine

# Set the working directory for any subsequent ADD, COPY, CMD, ENTRYPOINT,
# or RUN instructions that follow it in the Dockerfile
WORKDIR /usr/src/app

# Copy files or folders from source to the dest path in the image's filesystem.
COPY package.json /usr/src/app/
COPY . /usr/src/app/

# Execute any commands on top of the current image as a new layer and commit the results.
RUN npm install --production

# Define the network ports that this container will listen to at runtime.
EXPOSE 1337

# Configure the container to be run as an executable.
ENTRYPOINT ["npm", "start"]
</code></pre>

<p>如果您已经安装了<a href="https://docs.docker.com/get-docker/" target="_blank" rel="noreferrer noopener"> Docker </a>，那么您可以在本地构建并运行容器进行测试。</p>

<p>在本教程的后面，您将学习如何使用CircleCI orbs来自动化这个过程。</p>

<p>要构建和标记容器，您可以键入:</p>

<pre><code class="language-bash">docker build -t nodejs-aks-app:latest .
</code></pre>

<p>通过从终端运行以下命令，确认映像已成功创建:</p>

<pre><code class="language-bash">docker images
</code></pre>

<p>然后使用以下命令运行容器:</p>

<pre><code class="language-bash">docker run -it -p 1337:1337 nodejs-aks-app:latest
</code></pre>

<p>应用程序现在应该在地址<code>http://127.0.0.1:1337</code>启动并运行。</p>

<p>提交并<a href="https://circleci.com/blog/pushing-a-project-to-github/">推送</a>对GitHub库的更改。</p>

<h2>为部署配置Kubernetes清单</h2>

<p>要在Kubernetes上部署容器，您需要配置Kubernetes，以包含运行应用程序所需的所有设置。Kubernetes使用<a href="https://yaml.org/" target="_blank" rel="noreferrer noopener"> YAML </a>进行配置。</p>

<p>在项目的根目录下创建一个名为<code>manifests</code>的目录。</p>

<p>然后，在新创建的文件夹中创建以下文件:</p>

<ul>
  <li><code>namespace.yaml</code></li>
  <li><code>deployment.yaml</code></li>
  <li><code>service.yaml</code></li>
  <li><code>kustomization.yaml</code></li>
</ul>

<p>在Kubernetes中，<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/" target="_blank" rel="noreferrer noopener">名称空间</a>提供了一种在单个集群中隔离资源组的机制。<br/><code>namespace.yaml</code>文件的内容如下:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Namespace
metadata:
  name: nodejs
  labels:
    name: nodejs
</code></pre>

<p>这个文件将在Kubernetes集群中创建一个名为<code>nodejs</code>的名称空间。所有资源都将在这个名称空间中创建。</p>

<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noreferrer noopener"> Kubernetes部署</a>管理集群上运行的无状态服务。他们的目的是保持一组相同的pod运行，并以受控的方式升级它们——默认情况下执行滚动更新。<code>deployment.yaml</code>的内容如下:</p>

<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: nodejs
  namespace: nodejs
  labels:
    app: nodejs
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nodejs
  template:
    metadata:
      labels:
        app: nodejs
    spec:
      nodeSelector:
        "beta.kubernetes.io/os": linux
      containers:
        - name: nodejs-aks-app
          image: nodejs-aks-app
          ports:
            - name: http
              containerPort: 1337
</code></pre>

<p>以下是这段代码的要点:</p>
<ul>
  <li><code>containerPort</code>是应用程序将要运行的端口。</li>
  <li>容器<code>image</code>是Docker映像，它将被拉入并部署到Kubernetes集群上的上述名称空间中。</li>
</ul>

<p><a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank" rel="noreferrer noopener"> Kubernetes服务</a>是一个抽象概念，它定义了一组逻辑pod和访问它们的策略。您需要一个类型为<code>LoadBalancer</code>的Kubernetes服务，以使外部世界可以访问部署。<code>service.yaml</code>的内容如下:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: nodejs
  namespace: nodejs
  labels:
    app: nodejs
spec:
  type: LoadBalancer
  ports:
    - port: 80
      targetPort: 1337
  selector:
    app: nodejs
</code></pre>

<p>以下是这段代码的要点:</p>
<ul>
  <li><code>targetPort</code>是集装箱港口。</li>
  <li><code>port</code>是应用程序将要运行的地方。</li>
  <li><code>type</code>是服务的类型(本例中为<code>LoadBalancer</code>)。</li>
</ul>

<p>要在Kubernetes集群上部署最新版本的应用程序，必须定制资源来维护更新的信息。这由定制Kubernetes配置的工具<a href="https://kustomize.io/"> Kustomize </a>管理。<code>kustomization.yaml</code>的内容如下:</p>

<pre><code class="language-yaml">apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - deployment.yaml
  - service.yaml
  - namespace.yaml
namespace: nodejs
images:
  - name: nodejs-aks-app
    newName: nodejs-aks-app
    newTag: v1
</code></pre>

<p>这里的要点是，在持续集成过程中，<code>newName</code>和<code>newTag</code>将自动更新最新的Docker映像信息。</p>

<p>将这些文件提交并推送到您之前克隆的GitHub存储库中。</p>

<h2>启动Azure Kubernetes服务(AKS)群集</h2>

<p>现在，您已经准备好在<a href="https://azure.microsoft.com/en-us/services/kubernetes-service/#overview" target="_blank" rel="noreferrer noopener"> AKS </a>集群上部署应用程序了。要创建AKS群集，您需要在计算机上安装Microsoft Azure帐户和Azure CLI。<a href="https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli">CLI应该连接到你的Azure账户</a>。</p>

<p>完成后，您可以在Azure CLI的帮助下启动AKS集群。</p>

<p>使用以下命令创建资源组:</p>

<pre><code class="language-bash">az group create --name NodeRG --location eastus
</code></pre>

<p>使用以下命令启动双节点集群:</p>

<pre><code class="language-bash">az aks create --resource-group NodeRG --name NodeCluster --node-count 2 --enable-addons http_application_routing
</code></pre>

<p><strong>注意:</strong> <i>如果您之前在系统中生成了任何SSH密钥，那么您需要在上面的命令中添加一个可选参数<code>--generate-ssh-keys</code>。如果缺少SSH公钥和私钥文件，这将自动生成它们。密钥将存储在<code>~/.ssh</code>目录中。</i></p>

<p>AKS群集将需要10-15分钟才能启动。</p>

<h2>创建持续集成管道</h2>

<p>本教程的目的是展示如何通过<a href="https://circleci.com/blog/what-is-a-ci-cd-pipeline/"> CI/CD管道</a>在Kubernetes上部署应用程序。管道应该触发构建容器的过程，将其推送到Dockerhub并部署到集群上。</p>

<p>要创建CI/CD管道，您将使用与您的GitHub帐户集成的CircleCI。CircleCI配置文件(<code>config.yml</code>)位于项目根文件夹的<code>.circleci</code>目录中。配置的路径是<code>.circleci/config.yml</code>。</p>

<p>以下是<code>config.yml</code>的内容:</p>

<pre><code class="language-yaml">version: 2.1

orbs:
  docker: circleci/docker@2.1.1
  azure-aks: circleci/azure-aks@0.3.0
  kubernetes: circleci/kubernetes@1.3.0

jobs:
  aks-deploy:
    executor: azure-aks/default
    parameters:
      cluster-name:
        description: |
          Name of the AKS cluster
        type: string
      resource-group:
        description: |
          Resource group that the cluster is in
        type: string
    steps:
      - checkout
      - run:
          name: Pull Updated code from repo
          command: git pull origin $CIRCLE_BRANCH
      - azure-aks/update-kubeconfig-with-credentials:
          cluster-name: &lt;&lt; parameters.cluster-name &gt;&gt;
          install-kubectl: true
          perform-login: true
          resource-group: &lt;&lt; parameters.resource-group &gt;&gt;
      - kubernetes/create-or-update-resource:
          resource-file-path: manifests/$APP_NAME.yaml
          resource-name: kustomization/$APP_NAME

  bump-docker-tag-kustomize:
    docker:
      - image: cimg/base:stable
    steps:
      - run:
          name: Install kustomize
          command: |
            URL=https://github.com/kubernetes-sigs/kustomize/releases/download/kustomize/v4.5.2/kustomize_v4.5.2_linux_amd64.tar.gz
            curl -L $URL | tar zx
            [ -w /usr/local/bin ] &amp;&amp; SUDO="" || SUDO=sudo
            $SUDO chmod +x ./kustomize
            $SUDO mv ./kustomize /usr/local/bin
      - checkout
      - run:
          name: Bump Docker Tag
          command: |
            cd manifests
            kustomize edit set image $APP_NAME=$DOCKER_LOGIN/$APP_NAME:$CIRCLE_SHA1
            kustomize build . &gt; $APP_NAME.yaml
      - add_ssh_keys:
          fingerprints:
            - "$SSH_FINGERPRINT"
      - run:
          name: Commit &amp; Push to GitHub
          command: |
            git config user.email "$GITHUB_EMAIL"
            git config user.name "CircleCI User"
            git checkout $CIRCLE_BRANCH           
            git add manifests/$APP_NAME.yaml
            git add manifests/kustomization.yaml
            git commit -am "Bumps docker tag [skip ci]"
            git push origin $CIRCLE_BRANCH

workflows:
  Deploy-App-on-AKS:
    jobs:
      - docker/publish:
          image: $DOCKER_LOGIN/$APP_NAME
          tag: $CIRCLE_SHA1,latest
      - bump-docker-tag-kustomize:
          requires:
            - docker/publish
      - aks-deploy:
          cluster-name: $CLUSTER_NAME
          resource-group: $RESOURCE_GROUP
          requires:
            - bump-docker-tag-kustomize
</code></pre>

<p>CI工作流由三个作业组成:</p>

<ul>
  <li><code>docker/publish</code>构建容器并将其推送到Docker Hub。</li>
  <li><code>bump-docker-tag-kustomize</code>更新Docker图像标签并生成一个合并的Kubernetes配置文件。</li>
  <li><code>aks-deploy</code>在AKS集群上应用配置文件。</li>
</ul>

<p>这个工作流程大量使用了<a href="https://circleci.com/orbs/"> CircleCI orbs </a>，它们是开源的、可共享的可参数化可重用配置元素包，包括作业、命令和执行器。orb可以直接使用，也可以用来创建定制作业。</p>

<p>提交并将更改推送到您的GitHub存储库。</p>

<h2>在CircleCI建立项目</h2>

<p>将应用程序部署到AKS的下一步是将GitHub存储库中的应用程序连接到CircleCI。</p>

<p>进入你的<a href="https://app.circleci.com/"> CircleCI仪表盘</a>，选择左边面板的项目选项卡。点击包含代码的GitHub库对应的<strong>设置项目</strong>按钮。在本教程中，回购被命名为<code>nodejs-aks-deploy</code>。</p>

<p><img src="../Images/f0cea4ba88ea5bdfce6d0aa0f52b6494.png" alt="CircleCI Dashboard" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-07-29-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-07-29-circleci-dashboard.png"/></p>

<p>当系统提示您选择config.yml文件时，选择<strong>最快</strong>选项并键入<code>main</code>作为分支名称。CircleCI会自动定位<code>config.yml</code>文件。点击<strong>设置项目</strong>。</p>

<p><img src="../Images/039ee392229c60acc77c08cc37c482c1.png" alt="Select your config.yml file" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-07-29-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-07-29-yaml-select.png"/></p>

<p>工作流将开始运行，但很快会将<code>status</code>显示为<code>Failed</code>。这是因为您仍然需要设置一个用户密钥，并在CircleCI项目设置中配置环境变量。</p>

<p>要设置用户密钥，请从项目设置页面的左侧面板中选择<strong> SSH密钥</strong>选项。在用户密钥部分，点击<strong>用GitHub </strong>授权。在工作流执行期间，CircleCI代表存储库所有者使用用户密钥将更改推送到您的GitHub帐户。</p>

<p><img src="../Images/783d190a899fb79d5b25bab353ad4927.png" alt="User Key" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-07-29-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-07-29-user-key.png"/></p>

<p>要配置环境变量，请从项目设置页面的左侧面板中选择<strong>环境变量</strong>选项。选择<strong>添加环境变量</strong>。接下来，键入环境变量和您希望为其赋值的值。</p>

<p><img src="../Images/7763d5f05ba5d7e462842a400b4ab00c.png" alt="Environment variables" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-07-29-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-07-29-env-vars.png"/></p>

<p>文件中使用的环境变量有:</p>

<ul>
  <li><code>APP_NAME</code>是容器图像名称(<code>nodejs-aks-app</code>)。</li>
  <li><code>AZURE_PASSWORD</code>是您的Azure帐户密码。</li>
  <li><code>AZURE_USERNAME</code>是您的Azure帐户用户名。</li>
  <li><code>CLUSTER_NAME</code>是AKS集群名称(<code>NodeCluster</code>)。</li>
  <li><code>DOCKER_LOGIN</code>是您的Docker Hub用户名。</li>
  <li><code>DOCKER_PASSWORD</code>是您的Docker Hub密码。</li>
  <li><code>GITHUB_EMAIL</code>是您的GitHub帐户电子邮件地址。</li>
  <li><code>RESOURCE_GROUP</code>是AKS资源组(<code>NodeRG</code>)。</li>
  <li><code>SSH_FINGERPRINT</code>是用于将更新的Docker标签推送到GitHub的用户密钥的SSH指纹。</li>
</ul>

<p><strong>注意:</strong> <i>要找到<code>SSH_FINGERPRINT</code>，进入项目设置，从侧边栏选择<strong> SSH按键</strong>。向下滚动到用户密钥部分，然后复制密钥。只有在点击<strong>授权GitHub </strong>按钮后，该键才会显示。</i></p>

<p>现在，您可以重新运行工作流。这次的<code>status</code>是<code>Success</code>。</p>

<p><img src="../Images/51801de60e3822e8fdddfbda77d8560b.png" alt="Successful workflow" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-07-29-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-07-29-passed-workflow.png"/></p>

<p>您还会发现另一个将<code>status</code>作为<code>Not Run</code>的管道。发生这种情况是因为在提交消息中包含术语<code>[skip ci]</code>明确指示CircleCI在向GitHub提交更新的配置文件时跳过管道。这保护了工作流免于永无止境的自触发循环。</p>

<h2>在AKS上访问应用程序</h2>

<p>当工作流重新运行时收到成功消息<code>status</code>,意味着应用程序已经部署在AKS集群上。要访问该应用程序，您需要群集的外部IP地址。</p>

<p>要找到<code>External-IP</code>，可以再次使用Azure CLI。</p>

<p>使用以下命令配置<code>kubectl</code>连接到AKS:</p>

<pre><code class="language-bash">az aks get-credentials --resource-group NodeRG --name NodeCluster
</code></pre>

<p>您在<code>nodejs</code>名称空间中创建了所有资源，所以使用下面的命令来获取名称空间中的所有资源:</p>

<pre><code class="language-bash">kubectl get all --namespace nodejs
</code></pre>

<p>复制<code>service/nodejs</code>对应的<code>External-IP</code>。</p>

<p><img src="../Images/a99f2d41fc3c0ffe97f91e8c3dc03a84.png" alt="External-IP" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-07-29-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-07-29-external-ip.png"/></p>

<p>您可以在<code>http://&lt;EXTERNAL-IP&gt;</code>访问应用程序。对我来说，那就是<code>http://20.102.11.73/</code>。</p>

<p><img src="../Images/b703ec359c7d407d7656c985679c6d56.png" alt="Final Application" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-07-29-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-07-29-final-application.png"/></p>

<h2>结论</h2>

<p>恭喜你！您已经到达教程的结尾。在本教程中，您了解了如何开发一个自动化的CI管道，用于在Kubernetes集群上持续部署您的应用程序。一旦正确配置了管道，对应用程序代码所做的任何更改都会立即反映在应用程序URL上。不再需要在Kubernetes上手动配置和部署应用程序。您可以更改环境变量的值，以便将CircleCI配置文件用于类似的应用程序。</p>

<p>本教程的完整源代码也可以在<a href="https://github.com/CIRCLECI-GWP/nodejs-aks-deploy">示例库</a>中找到。</p>

<hr/>



        
          
          
            <hr/>
            
<p>Avik Kundu是Red Hat的一名软件工程师。他是全栈开发人员、开源贡献者和精通DevOps和云的技术内容创建者。他是AWS社区构建者和Microsoft Learn学生大使。他写过关于媒体、开发和Opensource.com的各种工具和技术的文章和教程。他喜欢学习新技术，并在公共场合分享他的知识。</p>

            <p><a href="/blog/author/avik-kundu/" class="arrow-link">阅读更多Avik Kundu的帖子</a></p>
          
        
      </div>
    </div>    
</body>
</html>
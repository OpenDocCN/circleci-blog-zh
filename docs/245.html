<html>
<head>
<title>Using CI/CD to deploy web applications on Kubernetes with ArgoCD | CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用CI/CD在Kubernetes上部署web应用程序</h1>
<blockquote>原文：<a href="https://circleci.com/blog/deploy-to-kubernetes-with-argocd/#2022-10-21T09:00:00-07:00">https://circleci.com/blog/deploy-to-kubernetes-with-argocd/#2022-10-21T09:00:00-07:00</a></blockquote><div><div class="post-content col-xs-12 col-md-10 col-lg-8">
        

        <blockquote>
  <p>本教程涵盖:</p>
  <ol>
    <li>在Azure Kubernetes服务上部署Node.js应用程序</li>
    <li>使用orbs(YAML配置的可重用包)创建持续集成管道</li>
    <li>自动化ArgoCD以将最新的应用程序版本部署到Kubernetes集群</li>
  </ol>
</blockquote>

<p>GitOps 通过允许开发人员使用单一的事实来源(通常是Git存储库)来声明性地管理基础设施和代码，使软件管理和操作现代化。许多开发团队和组织已经采用GitOps过程来改进软件应用程序的创建和交付。</p>

<p>要让GitOps计划成功，像Kubernetes这样的编排系统是至关重要的。开发软件所需的大量不兼容技术使得Kubernetes成为管理基础设施的关键工具。没有Kubernetes，实现基础设施即代码(IaC)的过程是低效的，甚至是不可能的。幸运的是，Kubernetes的广泛采用使得实现GitOps的工具得以创建。</p>

<p>这些工具之一，<a href="https://argoproj.github.io/cd/" target="_blank" rel="noreferrer noopener"> ArgoCD </a>，是一个Kubernetes-native连续部署(CD)工具。它可以通过从g it存储库而不是外部CD解决方案中提取代码更改来直接将代码更改部署到Kubernetes资源中。其中许多解决方案仅支持基于推送的部署。使用ArgoCD使开发人员能够从一个统一的平台控制应用程序更新和基础设施设置。它处理GitOps过程的后期阶段，确保新的配置被正确地部署到Kubernetes集群。</p>

<p>在本教程中，您将学习如何使用CI/CD管道和ArgoCD在Azure Kubernetes Service (AKS)上部署Node.js应用程序。</p>

<h2>先决条件</h2>

<p>要跟随本教程，您首先需要一些东西。</p>

<p>占:</p>


<p>安装在您系统上的这些工具:</p>


<blockquote><p>我们的教程是平台无关的，但是使用CircleCI作为例子。如果你没有CircleCI账号，请在 注册一个免费的<a href="https://circleci.com/signup/"> <strong>。</strong></a></p></blockquote>

<p>完成所有先决条件后，您就可以进入下一部分了。</p>

<h2>克隆Node.js应用程序</h2>

<p>在本教程中，主要重点是在Kubernetes上部署应用程序。你可以直接<a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/cloning-a-repository" target="_blank" rel="noreferrer noopener">将<a href="https://github.com/CIRCLECI-GWP/aks-nodejs-argocd" target="_blank" rel="noreferrer noopener"> Node.js应用</a>克隆</a>到你的GitHub，并继续剩下的过程。</p>

<p>要克隆项目，请运行:</p>

<pre><code class="language-bash">git clone https://github.com/CIRCLECI-GWP/aks-nodejs-argocd.git
</code></pre>

<p>该存储库中有两个分支:</p>

<ul>
  <li><code>main</code>分支只包含Node.js应用程序代码</li>
  <li>分支包含应用程序代码以及您将创建的所有YAML文件</li>
</ul>

<p>检查到<code>main</code>分支。</p>

<p>Node.js应用程序位于<code>app.js</code>文件中，包含:</p>

<pre><code class="language-js">const express = require("express");
const path = require("path");
const morgan = require("morgan");
const bodyParser = require("body-parser");
/* eslint-disable no-console */
const port = process.env.PORT || 1337;
const app = express();
app.use(morgan("dev"));
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: "true" }));
app.use(bodyParser.json({ type: "application/vnd.api+json" }));
app.use(express.static(path.join(__dirname, "./")));
app.get("*", (req, res) =&gt; {
  res.sendFile(path.join(__dirname, "./index.html"));
});
app.listen(port, (err) =&gt; {
  if (err) {
    console.log(err);
  } else {
    console.log(`App at: http://localhost:${port}`);
  }
});
module.exports = app;
</code></pre>

<p>这段代码的关键是端口号，这是应用程序将要运行的地方，对于本教程来说是<code>1337</code>。</p>

<p>通过首先安装依赖项，您可以在本地运行应用程序。在项目的根目录中，键入:</p>

<pre><code class="language-bash">npm install
</code></pre>

<p>然后使用以下命令运行应用程序:</p>

<pre><code class="language-bash">node app.js
</code></pre>

<p>应用程序现在应该在地址<code>http://localhost:1337</code>启动并运行。</p>

<h2>容器化Node.js应用程序</h2>

<p>要部署Kubernetes的应用程序，您需要将其容器化。要使用Docker作为容器运行时工具来容器化应用程序，您将创建一个<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noreferrer noopener"> Dockerfile </a>。Dockerfile是一个文本文档，它包含用户可以在命令行上调用的所有命令来组合一个图像。</p>

<p>在项目的根目录下创建一个新文件，命名为<code>Dockerfile</code>。复制文件中的以下内容:</p>

<pre><code class="language-yaml"># Set the base image to use for subsequent instructions
FROM node:alpine
# Set the working directory for any subsequent ADD, COPY, CMD, ENTRYPOINT,
# or RUN instructions that follow it in the Dockerfile
WORKDIR /usr/src/app
# Copy files or folders from source to the dest path in the image's filesystem.
COPY package.json /usr/src/app/
COPY . /usr/src/app/
# Execute any commands on top of the current image as a new layer and commit the results.
RUN npm install --production
# Define the network ports that this container will listen to at runtime.
EXPOSE 1337
# Configure the container to be run as an executable.
ENTRYPOINT ["npm", "start"]
</code></pre>

<p>如果您已经安装了<a href="https://docs.docker.com/get-docker/" target="_blank" rel="noreferrer noopener"> Docker </a>，那么您可以在本地构建并运行容器进行测试。在本教程的后面，您将学习如何使用CircleCI orbs自动完成这个过程。</p>

<p>要构建和标记容器，请输入:</p>

<pre><code class="language-bash">docker build -t aks-nodejs-argocd:latest .
</code></pre>

<p>通过从终端运行以下命令，确认映像已成功创建:</p>

<pre><code class="language-bash">docker images
</code></pre>

<p>然后使用以下命令运行容器:</p>

<pre><code class="language-bash">docker run -it -p 1337:1337 aks-nodejs-argocd:latest
</code></pre>

<p>应用程序现在应该在地址<code>http://127.0.0.1:1337</code>启动并运行。</p>

<p>提交并<a href="https://circleci.com/blog/pushing-a-project-to-github/">推送</a>对GitHub库的更改。</p>

<h2>为部署配置Kubernetes清单</h2>

<p>要在Kubernetes上部署容器，您必须配置Kubernetes，以包含运行应用程序所需的所有设置。Kubernetes使用<a href="https://yaml.org/" target="_blank" rel="noreferrer noopener"> YAML </a>进行配置。</p>

<p>在项目的根目录下创建一个名为<code>manifests</code>的目录。然后在新创建的文件夹中创建这些文件:</p>

<ul>
  <li><code>namespace.yaml</code></li>
  <li><code>deployment.yaml</code></li>
  <li><code>service.yaml</code></li>
  <li><code>kustomization.yaml</code></li>
</ul>

<p>在Kubernetes中，<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/" target="_blank" rel="noreferrer noopener">名称空间</a>提供了一种在单个集群中隔离资源组的机制。<code>namespace.yaml</code>的内容:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Namespace
metadata:
  name: nodejs
  labels:
    name: nodejs
</code></pre>

<p>这个文件将在Kubernetes集群中创建一个名为<code>nodejs</code>的名称空间。所有资源都将在这个名称空间中创建。</p>

<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noreferrer noopener"> Kubernetes部署</a>管理集群上运行的无状态服务。他们的目的是保持一组相同的pod运行，并以受控的方式升级它们——默认情况下执行滚动更新。<code>deployment.yaml</code>的内容:</p>

<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: nodejs
  namespace: nodejs
  labels:
    app: nodejs
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nodejs
  template:
    metadata:
      labels:
        app: nodejs
    spec:
      nodeSelector:
        "beta.kubernetes.io/os": linux
      containers:
        - name: aks-nodejs-argocd
          image: aks-nodejs-argocd
          ports:
            - name: http
              containerPort: 1337
</code></pre>

<p>这段代码的关键是<code>containerPort</code>。这是应用程序运行的地方，也是在Kubernetes集群的名称空间中提取和部署<code>container-image</code>的地方。</p>

<p><a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank" rel="noreferrer noopener"> Kubernetes服务</a>是一个抽象，它定义了一组逻辑pod和访问它们的策略。您需要Kubernetes服务类型<code>LoadBalancer</code>来使外部世界可以访问部署。<br/><code>service.yaml</code>的内容有:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: nodejs
  namespace: nodejs
  labels:
    app: nodejs
spec:
  type: LoadBalancer
  ports:
    - port: 80
      targetPort: 1337
  selector:
    app: nodejs
</code></pre>

<p>这段代码的关键是<code>targetPort</code>、<code>port</code>和<code>type</code>:</p>
<ul>
  <li><code>targetPort</code>是集装箱港口</li>
  <li><code>port</code>是应用程序将要运行的地方</li>
  <li><code>type</code>是服务的类型</li>
</ul>

<p>要在Kubernetes集群上部署最新版本的应用程序，必须定制资源来维护更新的信息。你可以使用<a href="https://kustomize.io/" target="_blank" rel="noreferrer noopener"> Kustomize </a>，这是一个定制Kubernetes配置的工具。</p>

<p><code>kustomization.yaml</code>的内容是:</p>

<pre><code class="language-yaml">apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - deployment.yaml
  - service.yaml
  - namespace.yaml
namespace: nodejs
images:
  - name: aks-nodejs-argocd
    newName: aks-nodejs-argocd
    newTag: v1
</code></pre>

<p>这段代码的关键是<code>newName</code>和<code>newTag</code>，作为持续集成过程的一部分，它们将使用最新的Docker图像信息进行更新。</p>

<p>提交并<a href="https://circleci.com/blog/pushing-a-project-to-github/">推送</a>这些文件到您之前克隆的GitHub库的<code>main</code>分支。</p>

<h2>启动Azure Kubernetes服务(AKS)群集</h2>

<p>在本教程中，您将在<a href="https://azure.microsoft.com/en-us/services/kubernetes-service/#overview" target="_blank" rel="noreferrer noopener"> AKS </a>集群上部署应用程序。要创建AKS集群，Azure CLI应该<a href="https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli" target="_blank" rel="noreferrer noopener">连接到您的Azure帐户</a>。</p>

<p>要使用Azure CLI启动AKS群集，请使用以下命令创建资源组:</p>

<pre><code class="language-bash">az group create --name NodeRG --location eastus
</code></pre>

<p>启动双节点集群:</p>

<pre><code class="language-bash">az aks create --resource-group NodeRG --name NodeCluster --node-count 2 --enable-addons http_application_routing
</code></pre>

<p><strong>注意:</strong> <i>如果您之前在系统中生成了任何SSH密钥，那么您需要在这个命令中添加可选的<code>--generate-ssh-keys</code>参数。如果缺少SSH公钥和私钥文件，这会自动生成它们。密钥存储在<code>~/.ssh</code>目录中。</i></p>

<p>AKS群集将需要10到15分钟才能启动。</p>

<h2>在AKS集群中安装ArgoCD</h2>

<p>一旦集群启动并运行，您就可以在集群内部安装ArgoCD。您将使用ArgoCD部署您的应用程序。</p>

<p>要安装该应用程序，请使用Azure CLI。使用以下命令配置<code>kubectl</code>连接到AKS:</p>

<pre><code class="language-bash">az aks get-credentials --resource-group NodeRG --name NodeCluster
</code></pre>

<p>要安装ArgoCD，请使用以下命令:</p>

<pre><code class="language-bash">kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
</code></pre>

<p>ArgoCD将安装在<code>argocd</code>名称空间中。要获取命名空间中的所有资源，请输入:</p>

<pre><code class="language-bash">kubectl get all --namespace argocd
</code></pre>

<h3>公开ArgoCD API服务器</h3>

<p>默认情况下，ArgoCD API服务器不会向外部IP公开。因为在本教程中您将从internet访问应用程序，所以您需要通过服务类型负载平衡器向ArgoCD服务器提供外部IP。</p>

<p>将argocd-server服务类型更改为LoadBalancer:</p>

<pre><code class="language-bash">kubectl patch svc argocd-server -n argocd -p '{"spec": {"type": "LoadBalancer"}}'
</code></pre>

<p><strong>注意:</strong> <i>你也可以使用Kubectl端口转发来连接API服务器而不暴露服务。使用此命令:<code>kubectl port-forward svc/argocd-server -n argocd 8080:443</code> </i></p>

<p>您现在可以使用<code>https://localhost:8080</code>访问API服务器。</p>

<h2>访问ArgoCD门户网站</h2>

<p>一旦您使用外部IP公开了ArgoCD API服务器，您现在就可以使用您生成的外部IP地址访问门户了。</p>

<p>ArgoCD安装在<code>argocd</code>名称空间中。使用此命令获取命名空间中的所有资源:</p>

<pre><code class="language-bash">kubectl get all --namespace argocd
</code></pre>

<p>复制<code>service/argocd-server</code>对应的<code>External-IP</code>。</p>

<p><img src="../Images/6d41d61472b6fc9b07cda8f6304dff31.png" alt="External-IP" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-10-21-external-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-10-21-external-ip.png"/></p>

<p>您可以在<code>http://&lt;EXTERNAL-IP&gt;</code>访问应用程序。<br/>对我来说，那是<code>http://20.237.108.112/</code></p>

<p><img src="../Images/3bc26d1cb4ae28d3d3f6ef167d171bb8.png" alt="ArgoCD application" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-10-21-argocd-application.png"/></p>

<p>要登录门户，您需要用户名和密码。用户名默认设置为<code>admin</code>。</p>

<p>要获取密码，请执行以下命令:</p>

<pre><code class="language-bash">kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d; echo
</code></pre>

<p>使用此用户名/密码组合登录ArgoCD门户。</p>

<h2>为ArgoCD配置Kubernetes清单</h2>

<p>要配置ArgoCD在Kubernetes上部署您的应用程序，您必须设置ArgoCD，使用<a href="https://yaml.org/" target="_blank" rel="noreferrer noopener"> YAML </a>进行配置，以声明的方式连接Git存储库和Kubernetes。</p>

<p>除此之外，您还可以从Web门户或使用ArgoCD CLI设置ArgoCD。因为本教程遵循GitOps原则，所以我们使用Git库作为唯一的事实来源。因此，使用YAML文件的声明性方法效果最好。</p>

<p>ArgoCD的关键特性和功能之一是通过手动或自动策略将应用程序部署到Kubernetes集群。</p>

<p>首先，在项目的根目录下创建一个名为<code>argocd</code>的目录。在新目录下创建一个新文件，并将其命名为<code>config.yaml</code>。</p>

<h3>手动同步策略</h3>
<p>使用此策略通过CI/CD管道手动同步应用程序。每当进行代码更改时，就会触发CI/CD管道，并调用ArgoCD服务器API来根据您将提交的更改启动同步过程。要与ArgoCD服务器API通信，您可以使用ArgoCD CLI。您也可以使用适用于各种编程语言的SDK之一。</p>

<p>为ArgoCD设置手动同步策略，将其粘贴到<code>config.yaml</code>:</p>

<pre><code class="language-yaml">apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: aks-nodejs-argocd
  namespace: argocd
spec:
  destination:
    namespace: nodejs
    server: "https://kubernetes.default.svc"
  source:
    path: manifests
    repoURL: "https://github.com/Lucifergene/aks-nodejs-argocd"
    targetRevision: circleci-project-setup
  project: default
</code></pre>

<h3>自动同步策略</h3>
<p>ArgoCD能够在检测到Git中所需清单与集群中实时状态之间的差异时，自动同步应用程序。</p>

<p>自动同步的一个好处是CI/CD管道不再需要直接访问ArgoCD API服务器来执行部署。取而代之的是，管道使用跟踪Git repo中的清单更改来提交和推送Git存储库。</p>

<p>如果要设置为自动同步策略，需要将其粘贴到<code>config.yaml</code>中</p>
<pre><code class="language-yaml">apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: aks-nodejs-argocd
  namespace: argocd
spec:
  destination:
    namespace: nodejs
    server: "https://kubernetes.default.svc"
  source:
    path: manifests
    repoURL: "https://github.com/Lucifergene/aks-nodejs-argocd"
    targetRevision: circleci-project-setup
  project: default
  syncPolicy:
    automated:
      prune: false
      selfHeal: false
</code></pre>

<p>提交并<a href="https://circleci.com/blog/pushing-a-project-to-github/">将这些文件</a>到您之前克隆的GitHub库的<code>main</code>分支中。</p>

<h2>创建持续集成管道</h2>

<p>本教程的目的是展示如何通过CircleCI的<a href="https://circleci.com/continuous-integration/">持续集成</a> (CI)和ArgoCD的<a href="https://circleci.com/blog/a-brief-history-of-devops-part-iv-continuous-delivery-and-continuous-deployment/">持续部署</a> (CD)在Kubernetes上部署应用程序。CI管道应该触发构建容器的过程，将其推送到Docker Hub，CD应该在Kubernetes上部署应用程序。</p>

<p>要创建CI管道，您将使用与您的GitHub帐户集成的CircleCI。CircleCI配置名为<code>config.yml</code>，位于项目根文件夹的<code>.circleci</code>目录中。配置的路径是<code>.circleci/config.yml</code>。</p>

<p><code>config.yml</code>的内容是:</p>

<pre><code class="language-yaml">version: 2.1

orbs:
  docker: circleci/docker@2.1.1
  azure-aks: circleci/azure-aks@0.3.0
  kubernetes: circleci/kubernetes@1.3.0

jobs:
  argocd-manual-sync:
    docker:
      - image: cimg/base:stable
    parameters:
      server:
        description: |
          Server IP of of ArgoCD
        type: string
      username:
        description: |
          Username for ArgoCD
        type: string
      password:
        description: |
          Password for ArgoCD
        type: string
    steps:
      - run:
          name: Install ArgoCD CLI
          command: |
            URL=https://&lt;&lt; parameters.server &gt;&gt;/download/argocd-linux-amd64
            [ -w /usr/local/bin ] &amp;&amp; SUDO="" || SUDO=sudo
            $SUDO curl --insecure -sSL -o /usr/local/bin/argocd $URL
            $SUDO chmod +x /usr/local/bin/argocd
      - run:
          name: ArgoCD CLI login
          command: argocd login &lt;&lt; parameters.server &gt;&gt; --insecure --username &lt;&lt; parameters.username &gt;&gt; --password &lt;&lt; parameters.password &gt;&gt;
      - run:
          name: Manual sync
          command: argocd app sync $APP_NAME
      - run:
          name: Wait for application to reach a synced and healthy state
          command: argocd app wait $APP_NAME

  argocd-configure:
    executor: azure-aks/default
    parameters:
      cluster-name:
        description: |
          Name of the AKS cluster
        type: string
      resource-group:
        description: |
          Resource group that the cluster is in
        type: string
    steps:
      - checkout
      - run:
          name: Pull Updated code from repo
          command: git pull origin $CIRCLE_BRANCH
      - azure-aks/update-kubeconfig-with-credentials:
          cluster-name: &lt;&lt; parameters.cluster-name &gt;&gt;
          install-kubectl: true
          perform-login: true
          resource-group: &lt;&lt; parameters.resource-group &gt;&gt;
      - kubernetes/create-or-update-resource:
          resource-file-path: argocd/config.yaml

  bump-docker-tag-kustomize:
    docker:
      - image: cimg/base:stable
    steps:
      - run:
          name: Install kustomize
          command: |
            URL=https://github.com/kubernetes-sigs/kustomize/releases/download/kustomize/v4.5.2/kustomize_v4.5.2_linux_amd64.tar.gz
            curl -L $URL | tar zx
            [ -w /usr/local/bin ] &amp;&amp; SUDO="" || SUDO=sudo
            $SUDO chmod +x ./kustomize
            $SUDO mv ./kustomize /usr/local/bin
      - checkout
      - run:
          name: Bump Docker Tag
          command: |
            cd manifests
            kustomize edit set image $APP_NAME=$DOCKER_LOGIN/$APP_NAME:$CIRCLE_SHA1
      - add_ssh_keys:
          fingerprints:
            - "$SSH_FINGERPRINT"
      - run:
          name: Commit &amp; Push to GitHub
          command: |
            git config user.email "$GITHUB_EMAIL"
            git config user.name "CircleCI User"
            git checkout $CIRCLE_BRANCH           
            git add manifests/kustomization.yaml
            git commit -am "Bumps docker tag [skip ci]"
            git push origin $CIRCLE_BRANCH

workflows:
  Deploy-App-on-AKS:
    jobs:
      - docker/publish:
          image: $DOCKER_LOGIN/$APP_NAME
          tag: $CIRCLE_SHA1,latest
      - bump-docker-tag-kustomize:
          requires:
            - docker/publish
      - argocd-configure:
          cluster-name: $CLUSTER_NAME
          resource-group: $RESOURCE_GROUP
          requires:
            - bump-docker-tag-kustomize
      # Paste the following only when you opt for the ArgoCD manual-sync-policy:
      - argocd-manual-sync:
          server: $ARGOCD_SERVER
          username: $ARGOCD_USERNAME
          password: $ARGOCD_PASSWORD
          requires:
            - argocd-configure
</code></pre>

<p>CI工作流由三个作业组成:</p>

<ul>
  <li><code>docker/publish</code>构建容器并将其推送到Docker Hub。</li>
  <li><code>bump-docker-tag-kustomize</code>更新Docker图像标签并生成一个合并的Kubernetes配置文件。</li>
  <li><code>argocd-configure</code>在AKS集群上应用ArgoCD配置。</li>
  <li><code>argocd-manual-sync</code>仅当您选择手动同步策略时才需要。对于自动同步，您可以从文件中忽略该作业。</li>
</ul>

<p>在这个工作流程中，我们广泛使用了<a href="https://circleci.com/orbs/"> CircleCI orbs </a>。orb是可参数化、可重用的配置元素的开源、可共享包，包括作业、命令和执行器。orb已被直接使用或用于创建自定义作业。</p>

<p>提交并<a href="https://circleci.com/blog/pushing-a-project-to-github/">推送</a>对GitHub库的更改。</p>

<h2>在CircleCI建立项目</h2>

<p>将应用程序部署到AKS的下一步是将GitHub存储库中的应用程序连接到CircleCI。</p>

<p>进入你的<a href="https://app.circleci.com/"> CircleCI仪表盘</a>，选择左边面板的项目选项卡。点击包含代码(<code>aks-nodejs-argocd</code>)的GitHub库的<strong>设置项目</strong>按钮。</p>

<p><img src="../Images/f1b7570468e568d0ad540e138423481b.png" alt="CircleCI Dashboard" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-10-21-circleci-dashboard.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-10-21-circleci-dashboard.png"/></p>

<p>当提示选择您的config.yml文件时，单击<strong>最快</strong>选项并键入<code>main</code>作为分支名称。CircleCI会自动定位<code>config.yml</code>文件。点击<strong>设置项目</strong>。</p>

<p><img src="../Images/2857bb86972e73a6d0e0f6f589c52e04.png" alt="Select your config.yml file" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-10-21-yaml-select.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-10-21-yaml-select.png"/></p>

<p>工作流将运行，但很快会显示一个<code>Failed</code>的<code>status</code>。这是因为您需要设置一个用户密钥并配置环境变量。</p>

<p>要设置用户密钥，请转到项目设置，然后在左侧面板中单击<strong> SSH密钥</strong>。在用户密钥部分，点击<strong>用GitHub </strong>授权。CircleCI需要用户密钥，以便在工作流执行期间代表存储库所有者将更改推送到您的GitHub帐户。</p>

<p><img src="../Images/33fb5dff0155281951d3bf3264e00d6f.png" alt="User key" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-10-21-user-key.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-10-21-user-key.png"/></p>

<p>要配置环境变量，点击<strong>环境变量</strong>。选择<strong>添加环境变量</strong>选项。在下一个屏幕上，键入环境变量和您想要分配给它的值。</p>

<p><img src="../Images/c3e8726cfa1e8338695ee4990f04bd1a.png" alt="Environment Variables" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-10-21-env-vars.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-10-21-env-vars.png"/></p>

<p>文件中使用的环境变量有:</p>

<ul>
  <li><code>APP_NAME</code>:容器镜像名(aks-nodejs-argocd)</li>
  <li><code>ARGOCD_PASSWORD</code> : ArgoCD门户密码</li>
  <li><code>ARGOCD_SERVER</code> : ArgoCD服务器IP地址</li>
  <li><code>ARGOCD_USERNAME</code> : ArgoCD门户用户名(管理员)</li>
  <li><code>AZURE_PASSWORD</code> : Azure账号密码</li>
  <li><code>AZURE_USERNAME</code> : Azure账号用户名</li>
  <li><code>CLUSTER_NAME</code> : AKS集群名(NodeCluster)</li>
  <li><code>DOCKER_LOGIN</code>:坞站枢纽用户名</li>
  <li><code>DOCKER_PASSWORD</code>:坞站集线器密码</li>
  <li><code>GITHUB_EMAIL</code> : GitHub账号邮箱</li>
  <li><code>RESOURCE_GROUP</code> : AKS资源组(NodeRG)</li>
  <li><code>SSH_FINGERPRINT</code>:用于将更新的Docker标签推送到GitHub的用户密钥的SSH指纹</li>
</ul>

<p>要定位<strong> SSH指纹</strong>，进入<strong>项目设置</strong>，从侧边栏选择<strong> SSH密钥</strong>。向下滚动到<strong>用户密钥</strong>部分并复制密钥。</p>

<p>重新运行工作流。这次<code>status</code>会显示<code>Success</code>。</p>

<p><img src="../Images/a08d586c399bd33d5c478c061b4cf674.png" alt="Success workflow" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-10-21-passed-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-10-21-passed-workflow.png"/></p>

<p>您还会发现另一个将<code>status</code>作为<code>Not Run</code>的管道。这是因为您已经通过在提交消息中包含<code>[skip ci]</code>明确指示CircleCI跳过管道。当CircleCI向GitHub提交更新后的配置文件时，<code>[skip ci]</code>防止了工作流的自触发循环。</p>

<h2>在ArgoCD仪表板上监控应用程序</h2>

<p>当工作流重新运行时，显示<code>Success</code>的<code>status</code>表示应用程序已经部署在AKS集群上。</p>

<p>要观察和监视当前在AKS集群上运行的资源，请登录ArgoCD门户网站。</p>

<p>在本教程的前面部分，您学习了如何获取ArgoCD服务器IP、用户名和密码以登录门户。登录后，您将进入应用程序页面。</p>

<p><img src="../Images/209481739597dc2a27ec752af4e3b1e5.png" alt="ArgoCD Application" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-application-page.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-10-21-argocd-application-page.png"/></p>

<p>单击应用程序名称。您将被重定向到一个页面，该页面包含AKS集群上运行的所有资源及其实时状态的树视图。</p>

<p><img src="../Images/85e6c763daed09d109e3bcca630bb53b.png" alt="ArgoCD App Tree view" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-10-21-argocd-app-tree-view.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-10-21-argocd-app-tree-view.png"/></p>

<h2>在AKS上访问应用程序</h2>

<p>要访问该应用程序，您需要群集的外部IP地址。您可以使用Azure CLI来查找<code>External-IP</code>。</p>

<p>使用以下命令配置<code>kubectl</code>连接到AKS:</p>

<pre><code class="language-bash">az aks get-credentials --resource-group NodeRG --name NodeCluster
</code></pre>

<p>您在<code>nodejs</code>名称空间中创建了所有的资源。要获取该命名空间中的所有资源，请使用以下命令:</p>

<pre><code class="language-bash">kubectl get all --namespace nodejs
</code></pre>

<p>复制<code>service/nodejs</code>对应的<code>External-IP</code>。</p>

<p><img src="../Images/c136407a6265c9edc3f536cbec4fa10d.png" alt="External-IP" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-10-21-external-app-ip.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-10-21-external-app-ip.png"/></p>

<p>您可以在<code>http://&lt;EXTERNAL-IP&gt;</code>访问应用程序。我的情况，那就是<code>http://20.121.253.220/</code>。</p>

<p><img src="../Images/9e22f22aaace68b2adc6f2198c2869e3.png" alt="Final application" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-10-21-final-application.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-10-21-final-application.png"/></p>

<h2>结论</h2>

<p>在本教程中，您学习了如何在Kubernetes集群上使用ArgoCD按照GitOps实践连续部署您的应用程序。这包括配置自动化CI渠道。正确配置管道后，对应用程序代码的任何更改都会在应用程序URL上立即更新。告别在Kubernetes上手动配置和部署应用。</p>

<p>另外，您可以更改环境变量的值，以便为类似的应用程序使用CircleCI配置文件。</p>

<p>本教程的完整源代码也可以在GitHub 上找到<a href="https://github.com/CIRCLECI-GWP/aks-nodejs-argocd" target="_blank" rel="noreferrer noopener">。</a></p>



        
          
          
            <hr/>
            
<p>Avik Kundu是Red Hat的一名软件工程师。他是全栈开发人员、开源贡献者和精通DevOps和云的技术内容创建者。他是AWS社区构建者和Microsoft Learn学生大使。他写过关于媒体、开发和Opensource.com的各种工具和技术的文章和教程。他喜欢学习新技术，并在公共场合分享他的知识。</p>

            <p><a href="/blog/author/avik-kundu/" class="arrow-link">阅读更多Avik Kundu的帖子</a></p>
          
        
      </div>
    </div>    
</body>
</html>
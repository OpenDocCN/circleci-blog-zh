<html>
<head>
<title>Build a CI powered RESTful API with Laravel | CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用Laravel | CircleCI构建CI驱动的RESTful API</h1>
<blockquote>原文：<a href="https://circleci.com/blog/build-a-ci-powered-restful-api-with-laravel/#2022-11-28T01:00:00-08:00">https://circleci.com/blog/build-a-ci-powered-restful-api-with-laravel/#2022-11-28T01:00:00-08:00</a></blockquote><div><div class="post-content col-xs-12 col-md-10 col-lg-8">
        

        <blockquote>
  <p>本教程涵盖:</p>
  <ol>
    <li>用Laravel构建RESTful API</li>
    <li>在本地测试API</li>
    <li>自动化API测试</li>
  </ol>
</blockquote>

<p>当谈到构建RESTful APIs时，PHP的开源Laravel框架仍然是web开发的五大后端框架之一。Laravel还通过提供一个易于使用的测试套件，使测试API端点变得轻而易举。在本文中，我们将使用Laravel构建一个基于令牌的身份验证API，为端点编写测试，并使用CircleCI自动化构建和测试过程。</p>

<h2>先决条件</h2>

<p>要跟进这篇文章，你需要一些东西:</p>

<ul>
  <li><a href="https://www.php.net/" target="_blank" rel="noreferrer noopener"> PHP </a> &gt; = 7.3安装在您的系统上(您可以通过在终端上运行命令<code>php -v</code>来确认您的版本是否足够高)</li>
  <li><a href="https://getcomposer.org/" target="_blank" rel="noreferrer noopener">全球安装的作曲家</a>(通过在您的终端上运行<code>composer</code>命令来确认)</li>
  <li>安装在您系统上的Git </li>
  <li>GitHub的一个账户</li>
  <li>一个<a href="https://circleci.com/signup/" target="_blank" rel="noreferrer noopener">圆</a>的账户</li>
</ul>

<blockquote><p>我们的教程是平台无关的，但是使用CircleCI作为例子。如果你没有CircleCI账号，请在 注册一个免费的<a href="https://circleci.com/signup/"> <strong>。</strong></a></p></blockquote>

<p>一旦你有了这些并运行，你将准备好跟随教程。</p>

<h2>搭建Laravel API</h2>

<p>第一步是构建一个新的Laravel应用程序。首先，发出以下命令:</p>

<pre><code class="language-bash">composer create-project laravel/laravel my-new-laravel-api
</code></pre>

<p>这将在命令运行的位置创建一个名为<code>my-new-laravel-api</code>的项目。你可以给你的项目取任何你想要的名字。</p>

<h2>设置数据库</h2>

<p>对于本教程，您将对测试数据库和主数据库使用SQLite。在实践中，您可能会使用更复杂的DBMS，如MySQL或MSSQL，但我们将在本教程中保持简单。主数据库的配置在<code>.env</code>文件中。创建一个<code>.env.testing</code>文件来保存您的测试数据库配置。</p>

<p>您已经有了默认项目搭建附带的<code>.env</code>文件。创建一个名为<code>.env.testing</code>的新文件，并将<code>.env.example</code>(也是默认创建的)的内容复制到其中。</p>

<p>用以下配置替换两个文件(<code>.env</code>和<code>.env.testing</code>)的数据库配置部分:</p>

<pre><code>DB_CONNECTION=sqlite
DB_HOST=null
DB_PORT=null
DB_DATABASE=database/database.sqlite
DB_USERNAME=null
DB_PASSWORD=null
</code></pre>

<p>因为主数据库和测试数据库都使用SQLite，所以两个文件使用相同的配置。在前面的代码片段中，您的连接被设置为<code>sqlite</code>，您的数据库被设置为<code>database.sqlite</code>，它位于<code>database</code>文件夹中。您还没有创建这个<code>database.sqlite</code>文件。进入项目根目录下的<code>database</code>文件夹并创建它。</p>

<p>设置数据库的最后一个任务是使用Laravel的一个助手指向<code>config/database.php</code>中数据库配置文件中的SQLite数据库文件。在<code>config/database.php</code>文件中，用下面的代码替换<code>connections</code>数组中的SQLite配置:</p>

<pre><code class="language-php">'sqlite' =&gt; [
            'driver' =&gt; 'sqlite',
            'database' =&gt; database_path('database.sqlite'),
            'prefix' =&gt; '',
    ],
</code></pre>

<p>这确保了SQLite配置总是指向正确的数据库路径，即使您更改了应用程序运行的环境。</p>

<p>要确认一切正常，请通过运行以下命令来迁移数据库:</p>

<pre><code class="language-bash">php artisan migrate
</code></pre>

<p>成功的迁移应该会显示类似于下面的屏幕截图:</p>

<p><img src="../Images/8e6eb2882a035d6865cb49767d66a8ac.png" alt="Successfull migration" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-migration.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-11-23-successful-migration.png"/></p>

<p>通过在您的<code>.gitignore</code>文件中声明它，确保您忽略了数据库文件。</p>

<h2>使用Passport设置基于令牌的身份验证</h2>

<p>您的下一个任务是设置一个API项目来使用基于令牌的身份验证。您将使用<a href="https://github.com/laravel/passport" target="_blank" rel="noreferrer noopener"> Laravel Passport </a> OAuth库来实现，该库为您的Laravel应用程序提供了完整的OAuth2服务器实现。首先，安装<code>laravel/passport</code>包:</p>

<pre><code class="language-bash">composer require laravel/passport
</code></pre>

<p>安装完成后，运行这个命令来运行<code>laravel/passport</code>附带的迁移:</p>

<pre><code class="language-bash">php artisan migrate
</code></pre>

<p>这应该会在命令行上打印出与下面类似的屏幕:</p>

<p><img src="../Images/2ad0a8ace2984de318e70c384dfde6b6.png" alt="Migrate Passport Table" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-11-23-migrate-laravel-passport.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-11-23-migrate-laravel-passport.png"/></p>

<p>Passport需要加密密钥来生成访问令牌，这些密钥需要生成并保存在数据库中。要生成这些密钥，请运行以下命令:</p>

<pre><code class="language-bash">php artisan passport:install
</code></pre>

<p>成功运行该命令后，您应该会看到生成的客户端机密。</p>

<p>下一步是将<code>Laravel\Passport\HasApiTokens</code>特征添加到您的<code>App\User</code>模型中。这将把<code>laravel/passport</code>包中的助手方法引入到应用程序中，以帮助检查用户的令牌和范围。打开<code>app/Models/User.php</code>文件，用下面的代码替换其内容:</p>

<pre><code class="language-php">&lt;?php

&lt;?php

namespace App\Models;

use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Passport\HasApiTokens;

class User extends Authenticatable
{
    use HasApiTokens, HasFactory, Notifiable;

    /**
     * The attributes that are mass assignable.
     *
     * @var array&lt;int, string&gt;
     */
    protected $fillable = [
        'name',
        'email',
        'password',
    ];

    /**
     * The attributes that should be hidden for serialization.
     *
     * @var array&lt;int, string&gt;
     */
    protected $hidden = [
        'password',
        'remember_token',
    ];

    /**
     * The attributes that should be cast.
     *
     * @var array&lt;string, string&gt;
     */
    protected $casts = [
        'email_verified_at' =&gt; 'datetime',
    ];
}

</code></pre>

<p>在这个文件中，您导入了<code>Laravel\Passport\HasApiTokens</code>特征并指示您的类使用它。</p>

<p>接下来，您需要调用包含在<code>app/Providers/AuthServiceProvider.php</code>文件中的<code>AuthServiceProvider</code>的引导方法中的<code>Passport::routes</code>方法。打开该文件，用下面的代码替换内容:</p>

<pre><code class="language-php">&lt;?php

namespace App\Providers;

use Laravel\Passport\Passport;
use Illuminate\Support\Facades\Gate;
use Illuminate\Foundation\Support\Providers\AuthServiceProvider as ServiceProvider;

class AuthServiceProvider extends ServiceProvider
{

    protected $policies = [
        'App\Model' =&gt; 'App\Policies\ModelPolicy',
    ];


    public function boot()
    {
        $this-&gt;registerPolicies();

        Passport::routes();
    }
}
</code></pre>

<p>最后，打开<code>config/auth.php</code>配置文件，定义一个api认证保护，将驱动选项设置为passport，如下所示:</p>

<pre><code class="language-php">'guards' =&gt; [
    'web' =&gt; [
        'driver' =&gt; 'session',
        'provider' =&gt; 'users',
    ],

    'api' =&gt; [
        'driver' =&gt; 'passport',
        'provider' =&gt; 'users',
    ],
],
</code></pre>

<p>这样，应用程序现在将使用Passport的TokenGuard来验证传入的请求。</p>

<h2>创建API端点</h2>

<p>您将构建一个简单的用户配置文件API。用户将能够:</p>

<ul>
  <li>注册一个新账户</li>
  <li>使用他们的登录凭据登录他们的帐户</li>
  <li>获取他们的个人资料</li>
  <li>注销应用程序</li>
</ul>

<p>您需要为这四个任务创建API端点。进入文件<code>routes/api.php</code>，用下面的代码替换它的内容:</p>

<pre><code class="language-php">&lt;?php

use App\Http\Controllers\AuthController;

Route::group([
    'prefix' =&gt; 'auth'
], function () {
    Route::post('login', [AuthController::class, 'login']);
    Route::post('signup', [AuthController::class, 'signup']);

    Route::group([
        'middleware' =&gt; 'auth:api'
    ], function() {
        Route::get('logout', [AuthController::class, 'logout']);
        Route::get('user', [AuthController::class, 'user']);
    });
});

</code></pre>

<p>这段代码创建了一个<code>auth</code>路由组，并为前面提到的四个任务创建了四条路由。</p>

<p>通过<code>auth:api</code>中间件对<code>auth/logout</code>和<code>auth/user</code>路由进行认证，以确保只有通过认证的访问才被允许访问这些端点。您还引用了上面的<code>AuthController</code>，这是您接下来要创建的控制器。为此，运行以下命令来创建控制器:</p>

<pre><code class="language-bash">php artisan make:controller AuthController
</code></pre>

<p>现在将这段代码放到新创建的控制器中:</p>

<pre><code class="language-php">&lt;?php

namespace App\Http\Controllers;

use App\Models\User;
use Carbon\Carbon;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

class AuthController extends Controller
{
    /**
     * Create user
     *
     * @param  [string] name
     * @param  [string] email
     * @param  [string] password
     * @param  [string] password_confirmation
     * @return [string] message
     */
    public function signup(Request $request)
    {
        $request-&gt;validate([
            'name' =&gt; 'required|string',
            'email' =&gt; 'required|string|email|unique:users',
            'password' =&gt; 'required|string|confirmed'
        ]);

        $user = new User([
            'name' =&gt; $request-&gt;name,
            'email' =&gt; $request-&gt;email,
            'password' =&gt; bcrypt($request-&gt;password)
        ]);

        $user-&gt;save();

        return response()-&gt;json([
            'message' =&gt; 'Successfully created user!'
        ], 201);
    }

    /**
     * Login user and create token
     *
     * @param  [string] email
     * @param  [string] password
     * @param  [boolean] remember_me
     * @return [string] access_token
     * @return [string] token_type
     * @return [string] expires_at
     */
    public function login(Request $request)
    {
        $request-&gt;validate([
            'email' =&gt; 'required|string|email',
            'password' =&gt; 'required|string',
            'remember_me' =&gt; 'boolean'
        ]);

        $credentials = request(['email', 'password']);
        if(!Auth::attempt($credentials)){
            return response()-&gt;json([
                'message' =&gt; 'Unauthorized'
            ], 401);
        }

        $user = $request-&gt;user();
        $tokenResult = $user-&gt;createToken('Personal Access Token');
        $token = $tokenResult-&gt;token;

        if ($request-&gt;remember_me){
            $token-&gt;expires_at = Carbon::now()-&gt;addWeeks(1);
        }

        $token-&gt;save();

        return response()-&gt;json([
            'access_token' =&gt; $tokenResult-&gt;accessToken,
            'token_type' =&gt; 'Bearer',
            'expires_at' =&gt; Carbon::parse(
                $tokenResult-&gt;token-&gt;expires_at
            )-&gt;toDateTimeString()
        ]);
    }

    /**
     * Logout user (Revoke the token)
     *
     * @return [string] message
     */
    public function logout(Request $request)
    {
        $request-&gt;user()-&gt;token()-&gt;revoke();

        return response()-&gt;json([
            'message' =&gt; 'Successfully logged out'
        ]);
    }

    /**
     * Get the authenticated User
     *
     * @return [json] user object
     */
    public function user(Request $request)
    {
        return response()-&gt;json($request-&gt;user());
    }
}

</code></pre>

<p>这是一大堆代码。我会一点一点地为你解释。</p>

<h3>注册方法</h3>

<p>该方法接收电子邮件、密码和用户名作为参数，然后在<code>User</code>模型上使用Lucid模型的<code>save()</code>方法创建一个用户，并返回一条成功消息以及状态201。</p>

<h3>登录方法</h3>

<p>该方法接收用户电子邮件和密码以及一个可选的<code>remember_me</code>参数。然后，它验证凭证，并在成功验证后，返回访问令牌、令牌类型和令牌将过期的时间。</p>

<h3>注销方法</h3>

<p>该方法接收并撤销给予用户的访问令牌，然后在注销时发送成功消息。</p>

<h3>用户方法</h3>

<p>该方法接收用户的访问令牌，并使用它返回用户的详细信息。</p>

<p><strong>注意:</strong> <i>如果你看到在你的项目中创建了一个文件<code>.rnd</code>，忽略这个文件，把它添加到你的<code>.gitignore</code>文件中。</i></p>

<h2>测试API端点</h2>

<p>现在是时候为API端点编写一些测试了。通过运行以下命令创建测试:</p>

<pre><code class="language-bash">php artisan make:test UserTest
</code></pre>

<p>这将在<code>tests/Feature</code>文件夹中创建<code>UserTest</code>测试文件。删除文件夹中默认的<code>ExampleTest.php</code>文件。打开刚刚创建的<code>UserTest.php</code>文件，用下面的代码替换其内容:</p>

<pre><code class="language-php">&lt;?php

namespace Tests\Feature;

use Tests\TestCase;
use Illuminate\Foundation\Testing\WithFaker;
use Illuminate\Foundation\Testing\RefreshDatabase;

use App\Models\User;

class UserTest extends TestCase
{

    use WithFaker;

    private $password = "mypassword";

    public function testUserCreation()
    {

        $name = $this-&gt;faker-&gt;name();
        $email = $this-&gt;faker-&gt;email();

        $response = $this-&gt;postJson('/api/auth/signup', [
            'name' =&gt; $name,
            'email' =&gt; $email,
            'password' =&gt; $this-&gt;password,
            'password_confirmation' =&gt; $this-&gt;password
        ]);


        $response
            -&gt;assertStatus(201)
            -&gt;assertExactJson([
                'message' =&gt; "Successfully created user!",
            ]);
    }

    public function testUserLogin()
    {
        $name = $this-&gt;faker-&gt;name();
        $email = $this-&gt;faker-&gt;email();

        $user = new User([
            'name' =&gt; $name,
            'email' =&gt; $email,
            'password' =&gt; bcrypt($this-&gt;password)
        ]);

        $user-&gt;save();

        $response = $this-&gt;postJson('/api/auth/login', [
            'email' =&gt; $email,
            'password' =&gt; $this-&gt;password
        ]);


        $response-&gt;assertStatus(200);
        $this-&gt;assertAuthenticated();
    }

}

</code></pre>

<p>该文件包含对<code>/api/auth/signup</code>和<code>/api/auth/login</code> API端点的测试。这些端点确保用户能够成功注册和登录。该测试使用已经安装的PHP <a href="https://github.com/fzaninotto/Faker" target="_blank" rel="noreferrer noopener"> Faker库</a>生成了一个随机的电子邮件地址和用户名，以及一个通用密码来创建一个新的用户帐户。该测试还断言在控制器中定义了适当的HTTP状态代码和消息。</p>

<h2>在本地运行测试</h2>

<p>现在来测试一下。您将使用PHPUnit来运行您的测试。PHPUnit的安装附带了<code>phpunit</code> CLI命令。您可以通过全局安装<a href="https://phpunit.de/" target="_blank" rel="noreferrer noopener"> PHPUnit </a>来全局运行这个命令，或者在项目级别运行它。默认搭建的Laravel项目已经在本地安装了包，这使我们能够运行您的测试。</p>

<p>要运行测试，请在项目根目录下运行以下命令:</p>

<pre><code class="language-bash">php artisan test
</code></pre>

<p>这将使用您本地安装的软件包运行<code>phpunit</code>命令。如果一切顺利，您的所有测试都应该成功运行，您应该会看到类似下面的屏幕。</p>

<p><img src="../Images/0a5e945e1d355350ff416b40a1e77f0a.png" alt="PHPUnit test successful" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-phpunit-test.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-11-23-successful-phpunit-test.png"/></p>

<h2>用CircleCI自动化测试</h2>

<p>是时候将CI/CD的强大功能引入您的Laravel API了。您将创建一个管道，在每次推送新代码时自动运行测试。您可以从CircleCI获得成功或失败的CI/CD管道状态。您的管道将由以下步骤组成:</p>

<ul>
  <li>启动所需的环境</li>
  <li>使用composer安装依赖项</li>
  <li>为项目设置一个<code>.env</code>环境文件</li>
  <li>设置测试数据库并运行迁移</li>
  <li>为<code>laravel/passport</code>包生成加密密钥</li>
  <li>运行测试</li>
</ul>

<p>要创建CI/CD管道，您需要为CircleCI编写一个配置文件。进入项目的根目录，创建一个名为<code>.circleci</code>的文件夹。在这个文件夹中，创建一个名为<code>config.yml</code>的文件。</p>

<p>打开新创建的配置文件，使用以下代码:</p>

<pre><code class="language-yaml">version: 2.1
orbs:
  browser-tools: circleci/browser-tools@1.1
jobs:
  build:
    docker:
      # Specify the version you desire here
      - image: cimg/php:7.4.14-browsers

    steps:
      - browser-tools/install-browser-tools
      - checkout

      - run:
          name: "Create Environment file and generate app key"
          command: |
            mv .env.testing .env

      # Download and cache dependencies
      - restore_cache:
          keys:
            # "composer.lock" can be used if it is committed to the repo
            - v1-dependencies-{{ checksum "composer.json" }}
            # fallback to using the latest cache if no exact match is found
            - v1-dependencies-

      - run:
          name: "Install Dependencies"
          command: composer install -n --prefer-dist

      - save_cache:
          key: v1-dependencies-{{ checksum "composer.json" }}
          paths:
            - ./vendor

      # prepare the database
      - run:
          name: "Generate App key"
          command: php artisan key:generate

      - run:
          name: "Install sqlite"
          command: sudo apt-get install php7.4-sqlite3

      - run:
          name: "Create database and run migration"
          command: |
            touch database/database.sqlite
            php artisan migrate --env=testing

      - run:
          name: "Generate Passport encryption keys"
          command: php artisan passport:install

      # run tests with phpunit
      - run:
          name: "Run Tests"
          command: php artisan test
</code></pre>

<p>在这个配置文件中，您从<a href="https://hub.docker.com/search?q=circleci&amp;type=image" target="_blank" rel="noreferrer noopener"> CircleCI映像注册表</a>中提取了PHP的<a href="https://circleci.com/developer/images/image/cimg/php"> Docker映像</a>。这个图像包含PHP编程语言、composer、节点和浏览器扩展。</p>

<p>接下来，它检查您的代码，创建一个<code>.env</code>文件并安装项目的依赖项。用<code>php artisan key:generate</code>生成应用程序密钥后，安装SQLite，运行数据库迁移，最后用PHPUnit运行测试。</p>

<p>现在，您可以在GitHub上建立一个存储库，并将您的项目推送到其中。<a href="https://circleci.com/blog/pushing-a-project-to-github/">回顾将项目推送到GitHub </a>以获取指示。在下一节中，您将把项目链接到CircleCI。</p>

<h2>将API项目连接到CircleCI</h2>

<p>现在是时候把这个配置交给CircleCI来设置您的管道了。您可以通过将您的项目连接到CircleCI来实现。前往你的<a href="https://app.circleci.com/dashboard"> CircleCI仪表盘</a>。如果你注册了你的GitHub账户，你所有的库都可以在你项目的仪表盘上看到。</p>

<p>点击<code>my-new-laravel-api</code>项目旁边的设置项目。</p>

<p><img src="../Images/bd0f160471dfa71926f4bea2f3242108.png" alt="Select project" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-11-23-select-project.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-11-23-select-project.png"/></p>

<p>在<strong>选择您的config.yml文件</strong>屏幕上，选择最快的选项并键入<code>main</code>作为分支名称。CircleCI会自动定位<code>config.yml</code>文件。点击<strong>设置项目</strong>启动工作流程。</p>

<p><img src="../Images/cea8f00eefd896d22dc85f63078f986d.png" alt="Select Configuration" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-11-23-select-config.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-11-23-select-config.png"/></p>

<p>CircleCI将开始运行您的管道配置。如果您正确地遵循了说明，您应该会得到一个成功的构建，如下图所示。</p>

<p><img src="../Images/9a9ff6aebac13afe8fa319dab0803101.png" alt="Successfull Build" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-11-23-successful-build.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-11-23-successful-build.png"/></p>

<p>完美。您已经成功地为您的Laravel API提供了一个CI/CD管道，该管道使用CircleCI自动运行您的测试。</p>

<h2>结论</h2>

<p>在本文中，您使用Laravel开发了一个基于令牌的身份验证API，对其进行了测试，并使用为CircleCI创建并由circle CI运行的CI/CD管道自动化了构建和测试过程。这只是将自动化引入Laravel APIs开发的起点。使用CircleCI，您可以做更多的事情来创建一个更健壮、更复杂的管道，从而消除应用程序开发中涉及的大量手动任务。</p>

<p>我希望你从这篇文章中学到了一些有价值的东西。完整的源代码可以在GitHub 的<a href="https://github.com/CIRCLECI-GWP/my-new-laravel-api" target="_blank" rel="noreferrer noopener">这里找到。快乐编码:)</a></p>


        
          
          
            <hr/>
            <p>Fikayo Adepoju是LinkedIn Learning(Lynda.com)的作者、全栈开发人员、技术作者和技术内容创建者，精通Web和移动技术以及DevOps，拥有10多年开发可扩展分布式应用程序的经验。他为CircleCI、Twilio、Auth0和New Stack博客撰写了40多篇文章，并且在他的个人媒体页面上，他喜欢与尽可能多的从中受益的开发人员分享他的知识。你也可以在Udemy上查看他的视频课程。</p>

            <p><a href="/blog/author/fikayo-adepoju/" class="arrow-link">阅读Fikayo Adepoju的更多帖子</a></p>
          
        
      </div>
    </div>    
</body>
</html>
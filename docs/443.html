<html>
<head>
<title>Configuring a pipeline using multiple CircleCI orbs | CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用多个CircleCI orbs | CircleCI配置管道</h1>
<blockquote>原文：<a href="https://circleci.com/blog/multiple-orbs-pipeline-config/#2022-07-13T09:00:00-07:00">https://circleci.com/blog/multiple-orbs-pipeline-config/#2022-07-13T09:00:00-07:00</a></blockquote><div><div class="post-content col-xs-12 col-md-10 col-lg-8">
        

        <blockquote>
  <p>本教程涵盖:</p>
  <ol>
    <li>什么是球体以及如何使用它们</li>
    <li>为什么你可能想要使用多个球体</li>
    <li>使用多个orb设置配置</li>
  </ol>
</blockquote>

<p>持续集成/持续交付(CI/CD)工具为开发人员提供了自动化软件开发过程的能力。一旦开发人员将代码推送到git，您的CI/CD系统就可以进行构建、测试、试运行、集成测试、部署和伸缩。太棒了！</p>

<p>在本教程中，我们将看看CircleCI orbs以及它们如何支持您的CI/CD练习。我们将了解如何使用多个orb，以及orb如何帮助各种应用程序类型的多重构建。</p>

<h2>先决条件</h2>
<p>开始之前，请确保您具备以下要求:</p>
<ol>
  <li>一个<a href="https://circleci.com/signup/">圆</a>的账户</li>
  <li>GitHub的一个账户</li>
  <li>基本CI/CD知识</li>
  <li>对管道工作原理的基本理解</li>
</ol>

<p>在<a href="https://github.com/CIRCLECI-GWP/circleci-multiple-orbs-config" target="_blank" rel="noreferrer noopener"> GitHub </a>上可以获得演示应用的克隆版本。每个项目目录中都有设置和安装说明。</p>

<h2>什么是球体？</h2>

<p>orb是可重用的YAML配置包，它将配置减少到几行代码，允许开发人员轻松地打包、发布和重用配置。</p>

<p>球体非常有用，因为它们:</p>

<ol>
  <li>节省花费在项目设置上的时间</li>
  <li>提高组织效率</li>
  <li>简化第三方集成</li>
</ol>

<p>球体可以成为你的配置文件中的英雄。</p>

<p>要使用orb，请进入CircleCI <a href="https://circleci.com/developer/orbs"> orb注册表</a>。在那里，您将找到适合您的技术堆栈的orb以及开始使用的说明。如果你不能为你的技术栈找到一个orb，你可以按照CircleCI <a href="https://circleci.com/docs/orbs-best-practices/#orb-best-practices-guidelines">最佳实践</a>和<a href="https://circleci.com/docs/orb-author-intro/">入门</a>指南创建一个专门的orb。</p>

<p><img src="../Images/b0b2f6b36de1b2463f29862aac215a5d.png" alt="Multiple orbs illustration" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-07-12-multiple-orbs.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-07-12-multiple-orbs.png"/></p>

<h2>使用多个球体</h2>

<p>CircleCI支持在同一个配置文件中使用多个orbs这一节将向您展示如何使用您之前克隆的项目。</p>

<p>克隆的项目结合了一个Flask API和一个节点。JS命令行应用程序。我们已经对这两个应用程序进行了测试；它们需要使用<a href="https://circleci.com/developer/orbs/orb/circleci/python"> Python </a>和<a href="https://circleci.com/developer/orbs/orb/circleci/node">节点</a> orbs在CircleCI上运行。</p>

<h2>为什么是多个球体？</h2>

<p>就采用哪种技术以及何时采用而言，开发人员具有很强的适应性。大多数当前的应用程序都是由API组成的，带有一个前端插件来使用API。假设API是用Python构建的。开发人员决定使用像React这样的JavaScript框架作为前端。在这种情况下，我们有一个Python和JavaScript应用程序。</p>

<p>为这种类型的应用程序配置CI/CD管道时，您应该将所有配置放在一个配置文件中。这是因为CircleCI在<code>.circleci/config</code>中需要一个配置文件。</p>

<p>因为orb是灵活的，所以我们可以将orb组合在一个单独的<code>config.yml</code>文件中，在CircleCI上运行我们的测试。多个orb将导致更快的项目执行，更健壮的CI/CD管道，以及优秀的可重用性。</p>

<h2>设置多个球体</h2>

<p>配置多个orb的过程类似于配置单个orb的过程。</p>

<p>首先，请按照下列步骤操作:</p>

<ol>
  <li>在您的<code>.circleci/config.yml</code>文件的顶部，添加下面一行来指定CircleCI版本<pre><code class="language-yml">version: 2.1 </code></pre></li>
  <li>Invoke the orbs you wish to use. For example:
    <pre><code class="language-yml">orbs:
 node: circleci/node@5.0.2
 python: circleci/python@2.0.3
</code></pre>
    <p>这个代码块在CircleCI版本之后列出了orb。然后我们将在整个脚本中使用这两个。因为orb使用不同的名称引用，所以它们彼此完全独立。</p>
  </li>
  <li>将节点元素引入到现有的工作流和作业中。此时，orb的元素可以用作<code>&lt;orb-name&gt;/&lt;element&gt;</code>。</li>
</ol>

<p><img src="../Images/797fa40a0e7ba181c54517ca810aaed3.png" alt="Orb element" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-07-12-orb-elements.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-07-12-orb-elements.png"/></p>

<p>现在您已经了解了配置多个orb的基础知识，您可以开始使用Python和节点orb配置您的克隆应用程序了。这些orb是独一无二的，正确的配置可以在orb<a href="https://circleci.com/developer/orbs">文档</a>指南中找到。</p>

<p>下面是将配置文件分解成几个包含<code>version</code>、<code>orbs</code>、<code>jobs</code>和<code>workflow</code>的块。</p>

<h3>CircleCI版本</h3>
<pre><code class="language-yml">version: 2.1
</code></pre>
<h3>球</h3>

<p>这些是在管道中使用的特定orb版本:</p>

<pre><code class="language-yml">orbs:
 node: circleci/node@5.0.2
 python: circleci/python@2.0.3
</code></pre>
<h3>乔布斯</h3>

<p>您可以考虑让每个应用程序有两个单独的作业，因为您要测试两个。每个orb都有自己的执行任务。</p>

<p><strong>作业A </strong></p>

<p>角色:测试Python应用程序</p>

<p>使用的宝珠:Python宝珠</p>

<pre><code class="language-yml">jobs:
 test-python-app:
   executor: python/default
   steps:
     - checkout
     - python/install-packages:
         app-dir: ~/project/flask-api
         pip-dependency-file: requirements.txt
         pkg-manager: pip
     - run:
         command: |
           pytest -v
         name: Test
</code></pre>

<p><strong>作业B </strong></p>

<p>角色:测试JavaScript应用程序</p>

<p>使用的Orb:节点orb</p>

<pre><code class="language-yml"> test-node-app:
   executor: node/default
   steps:
     - checkout
     - node/install-packages:
         app-dir: ~/project/nodejs-cli
         cache-path: ~/project/nodejs-cli/node_modules
         override-ci-command: npm install
     - run:
         command: |
           npm run test
         working_directory: ~/project/nodejs-cli

</code></pre>
<h3>工作流程</h3>

<p>工作流决定了已定义作业的执行顺序。</p>

<pre><code class="language-yml">workflows:
 test:
   jobs:
     - test-python-app
     - test-node-app
</code></pre>

<h2>比较有和没有多个orb的配置</h2>

<p>在<a href="https://github.com/CIRCLECI-GWP/circleci-multiple-orbs-config" target="_blank" rel="noreferrer noopener">示例GitHub库</a>中可以找到<code>config.yml</code>的完整打包版本以供参考。典型配置不使用CircleCI orbs。</p>

<p>当您查看配置文件时，请注意不同之处，并使用不同的工作流运行每个工作流。例如，运行一个使用多个orb的<a href="https://github.com/CIRCLECI-GWP/circleci-multiple-orbs-config/blob/main/.circleci/config.yml" target="_blank" rel="noreferrer noopener">、</a>和一个使用标准配置的<a href="https://github.com/CIRCLECI-GWP/circleci-multiple-orbs-config/blob/feature/without-orbs/.circleci/config.yml" target="_blank" rel="noreferrer noopener">、</a>而没有orb。</p>

<p>除了orb提供的组织和可读性，回顾工作流运行时揭示了orb提供的更多好处。下面的屏幕截图显示了两个工作流的成功运行:一个使用标准配置，另一个使用orbs。</p>

<p><img src="../Images/8654d49f4d01a21cc0ca8e6f3457b1b1.png" alt="Two workflow comparison" class="zoomable" srcset="https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2022-07-12-two-workflow.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2022-07-12-two-workflow.png"/></p>

<p>此图显示，使用多个orb的配置运行的工作流比使用标准配置运行的工作流执行速度稍快。两种工作流中完成每项作业所需的时间略有不同。</p>

<p>球体又一次胜利了！</p>

<h2>结论</h2>

<p>本教程展示了在CI管道中使用多个orb的好处。您能够基于不同应用程序的架构配置CI管道来使用多个orb。您已经体验了多个orb如何加速工作流运行、提高可重用性以及简化与第三方应用程序的集成。直到下一次，继续建设！</p>


        
          
          
            <hr/>
            <p>Waweru Mwaura是一名软件工程师，也是一名专门研究质量工程的终身学习者。他是Packt的作者，喜欢阅读工程、金融和技术方面的书籍。你可以在<a href="https://waweruh.github.io/" target="_blank" rel="noreferrer noopener">他的网页简介</a>上了解更多关于他的信息。</p>

            <p><a href="/blog/author/waweru-mwaura/" class="arrow-link">阅读更多Waweru Mwaura的帖子</a></p>
          
        
      </div>
    </div>    
</body>
</html>
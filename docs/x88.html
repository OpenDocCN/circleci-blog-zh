<html>
<head>
<title>xcodebuild - exit code 65 | CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>xcodebuild -退出代码65 | CircleCI</h1>
<blockquote>原文：<a href="https://circleci.com/blog/xcodebuild-exit-code-65-what-it-is-and-how-to-solve-for-ios-and-macos-builds/#2017-05-01T10:51:00-07:00">https://circleci.com/blog/xcodebuild-exit-code-65-what-it-is-and-how-to-solve-for-ios-and-macos-builds/#2017-05-01T10:51:00-07:00</a></blockquote><div><div class="post-content col-xs-12 col-md-10 col-lg-8">
        

        <h2><code>xcodebuild</code>退出代码65:</h2>

<p>这四个字吓到了任何CI系统经验的iOS和macOS开发者。你们中的一些人可能在使用Xcode的时候已经看到了，但是没有意识到，因为Xcode对你们隐藏了那些错误代码。</p>

<p>为了防止<code>xcodebuild</code>返回没有任何错误信息的退出代码，我们必须理解退出代码65实际上指的是什么。</p>

<p>如果你在你选择的终端模拟器中输入<code>man xcodebuild</code>并滚动到(几乎)底部，你会在用法示例前看到这一小段:</p>

<p><img src="../Images/b3407973b7bf1994e06c4a124661764c.png" alt="xcodebuild exit code 65" srcset="https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/man%20xcode%20build%20image%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/man xcode build image exit code 65.png"/></p>



<p>这个小提示将我们带到了<code>sysexits</code>手册页。像HTTP状态码200 OK，404 Not Found或者<a href="https://en.wikipedia.org/wiki/Hyper_Text_Coffee_Pot_Control_Protocol" target="_blank" rel="noreferrer noopener"> 418我是茶壶</a>，常见的可执行返回码都定义在<code>sysexits.h</code>头文件中。常见的退出代码是退出代码65或错误数据输入。</p>

<p><img src="../Images/64c69b488c8e0c2dfacb815fd48a26af.png" alt="man xcodebuild exit code 65" srcset="https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/man%20syscode%20exit%20exit%20code%2065.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/man syscode exit exit code 65.png"/></p>

<p>知道了这一点，我们就可以研究为什么<code>xcodebuild</code>似乎喜欢用代码65退出。</p>

<p><code>xcodebuild</code>无疑是一个复杂的软件，本质上是类固醇上的<code>make</code> (1)。它决定了你的项目或工作空间的结构，并将所有的东西连同正确的标志一起交给编译器。日志中的单个命令的长度可以从50个字符到填满在27英寸iMac上以全屏模式运行的整个Safari窗口。</p>

<p>如果事情没有按照预期的方式进行(这种情况经常发生)，它将返回退出代码65。最令人沮丧的是<code>xcodebuild</code>很少为它无法处理的问题留下任何上下文。我们在<a href="https://discuss.circleci.com/t/xcode-exit-code-65/4284/13" target="_blank" rel="noreferrer noopener">与其中一种情况斗争了将近一年</a>。</p>

<p>每当<code>xcodebuild</code>执行完它的一个动作(清理、构建、测试、分析等等)，下一个动作就会立即执行，没有任何准备。此时，启动固定超时计数器。如果您的硬件不够快，在iOS模拟器有机会完全启动之前，这些超时将达到0。</p>

<p>这个问题在一些设置中变得更加严重，因为iOS模拟器会在后台线程上启动，如果另一个线程中有更重要的事情发生，它会被降低优先级。一旦超时值达到0，<code>xcodebuild</code>就会尝试几次连接iOS模拟器，但都失败了。这是因为<code>xcodebuild</code>坐在编译好的二进制和模拟器之间，所以不知道底层硬件的速度，也不一定能恢复。</p>

<p>在您的本地机器上，您可以通过翻白眼、叹气并再次按下CMD+U来解决这个问题。但是在CircleCI上，我们的系统关闭了所有的东西并回收了你上一次构建运行的虚拟机。</p>

<p>在正常的开发工作流程中，没有Xcode通用的派生数据文件夹或其他文件。工作目录将不存在，也不会运行任何iOS模拟器。在CircleCi上开始一个新的构建时，我们会面临同样的问题,<code>xcodebuild</code>可能无法从未知状态中恢复并返回退出代码65。</p>

<p>缓解这一问题的最佳方法是借助工具的命令行工具，尽早启动iOS模拟器。这将引导iOS模拟器并立即返回，因此<code>xcodebuild</code>可以开始编译您的代码。我们通常建议与依赖步骤分开进行，以提醒您未来的自己/同事这是一个至关重要的构建步骤——就像通过Carthage获取依赖或更新fastlane一样重要。</p>

<pre><code class="language-yaml">dependencies:
  pre:
    - xcrun instruments -w 'iPhone 7 (10.3)' || sleep 15
</code></pre>

<p>这个<code>sleep 15</code>很重要，有两个原因:它给iOS模拟器一些完全启动的喘息空间，并返回一个0退出代码。在不使用<code>set -o pipefail</code>的情况下将命令链接在一起时，将返回最后一个命令的退出代码，并忽略之前命令的代码。CircleCI查找构建步骤的退出代码以确定成功/失败。排除睡眠命令将意味着<code>xcrun instruments</code>将返回一个非零退出代码，因为<code>-t</code>(模板)标志没有通过。</p>

<p>希望这个对臭名昭著的<code>xcodebuild</code>退出代码65的解释能让你对为什么<code>xcodebuild</code>会做这些事情有所了解。每当你看到这个代码，<code>xcodebuild</code>就遇到了一个不可恢复的问题。我们将继续与苹果的开发者工具团队紧密合作，使开发者工具链更快、更稳定。</p>


        
          
          
        
      </div>
    </div>    
</body>
</html>
<html>
<head>
<title>Google bin auth - Kubernetes | CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Google bin auth-Kubernetes | circle ci</h1>
<blockquote>原文：<a href="https://circleci.com/blog/get-started-with-google-binary-authorization/#2019-09-18T11:00:00-07:00">https://circleci.com/blog/get-started-with-google-binary-authorization/#2019-09-18T11:00:00-07:00</a></blockquote><div><div class="post-content col-xs-12 col-md-10 col-lg-8">
        

        <h2>CircleCI的二进制授权orb的演练</h2>

<p>在Next’19上，Google <a href="https://cloud.google.com/blog/products/containers-kubernetes/all-the-kubernetes-security-news-from-google-cloud-next19">宣布</a>二进制授权的正式发布，这是一种针对部署在Google Kubernetes引擎上的容器图像的安全控制，CircleCI是其发布合作伙伴。我们的<a href="https://circleci.com/developer/orbs/orb/circleci/gcp-binary-authorization">二进制授权orb </a>简化了使用CircleCI构建、测试和部署的映像的验证过程，确保只有那些在CI/CD过程中由可信机构签名的映像才能在GKE上运行。</p>

<p>二进制授权，像Grafeas的<a href="https://github.com/grafeas/kritis"> Kritis </a>，它的开源、云不可知的对等物，使用一组不同的RESTful资源来管理和认证软件发布过程:</p>

<ul>
  <li><a href="https://cloud.google.com/binary-authorization/docs/key-concepts#policies"> Policies </a>:描述在被特定证明者授权后，哪些容器映像可以被部署到特定的Kubernetes集群的规则集；</li>
  <li><a href="https://cloud.google.com/binary-authorization/docs/key-concepts#attestors">证明者</a>:通过创建和签署证明来验证容器映像的部署准备状态的指定方，机器或人；</li>
  <li><a href="https://cloud.google.com/binary-authorization/docs/key-concepts#attestations">证明</a>:证明者证明单个映像满足部署所需的所有条件的声明。</li>
</ul>

<p>这些概念与CircleCI的功能相吻合，如<a href="https://circleci.com/blog/protect-secrets-with-restricted-contexts/">受限上下文</a>，它将秘密和环境变量的集合传递给特定的用户组，以及<a href="https://circleci.com/blog/manual-job-approval-and-scheduled-workflow-runs/">手动批准</a>工作。总之，这些资源允许开发-运营团队根据他们的需求和规范，使用自动和手动检查的组合来平衡部署时间和可靠性/安全性，从而精心设计全面的软件供应链安全流程。</p>

<p>CircleCI的orb让二进制授权很容易上手。一个作业<code>create-attestation</code>可以引导您完成创建策略、证明者和证明的整个过程。使用orb构建一个全新的GKE集群，或者直接引用一个已经存在的集群。即时制定政策，或者自己制定政策。orb甚至将生成并存储PGP密钥对，由证明者用来签署证明(通过Google的云密钥管理服务对非对称密钥的支持是orb路线图的下一步)。唯一的先决条件是谷歌云平台中的单个项目，或者对于一个<a href="https://cloud.google.com/binary-authorization/docs/multi-project-setup-cli">多项目设置</a>，三个独立的GCP项目(部署者、证明者、证明)。</p>

<p>与CircleCI的<a href="https://circleci.com/developer/orbs/orb/circleci/gcp-gcr">Google Container Registry orb</a>配对，二进制授权orb可以在YAML的几行代码中提供完整的部署解决方案，如这个<code>simple-deploy-attested-image</code> <a href="https://circleci.com/developer/orbs/orb/circleci/gcp-binary-authorization#usage-simple-deploy-attested-image">示例</a>所示:</p>

<pre><code class="language-yaml">version: 2.1

orbs:
  gcp-gcr: circleci/gcp-gcr@x.y.z
  bin-authz: circleci/gcp-binary-authorization@x.y.z

workflows:
  push_sign_deploy:
    jobs:
      - gcp-gcr/build_and_push_image:
          context: your-context # context containing any required env vars
          image: your-image # your image name
          registry-url: gcr.io # default value, here for clarity
          tag: your-tag # default value

      - bin-authz/create-attestation:
          context: your-context
          attestor: $CIRCLE_USERNAME # default value
          keypair-email: email.address@used.to.generate.keypair.com
          gke-cluster-name: your-GKE-cluster-name
          use-note-file: true
          note-filepath: your-container-analysis-note.json
          use-policy-file: true
          policy-filepath: your-binauthz-policy-file.yaml
          image-path: gcr.io/$GOOGLE_PROJECT_ID/your-image
          image-tag: your-tag
          requires: [gcp-gcr/build_and_push_image]
          deployment-steps:
            - run: |
                kubectl run your-server \
                  --image gcr.io/$GOOGLE_PROJECT_ID/your-image@$YOUR_IMAGE_DIGEST \
                  --port 8080
</code></pre>

<p>二进制授权orb有大量的参数，但是不要被淹没——它们被设计为合理的默认值，在大多数用例中最大限度地减少了样板文件。如需进一步指导，请参见orb的其他<a href="https://circleci.com/developer/orbs/orb/circleci/gcp-binary-authorization#usage-examples">使用示例</a>(其<a href="https://github.com/CircleCI-Public/gcp-binary-authorization-orb"> GitHub库</a>也有额外的说明)。</p>

<p>最后，由于所有CircleCI orbs都是开源的，如果你想在这个orb中看到其他东西，我们总是欢迎<a href="https://github.com/CircleCI-Public/gcp-binary-authorization-orb/issues">问题</a>和<a href="https://github.com/CircleCI-Public/gcp-binary-authorization-orb/pulls">拉请求</a>—<a href="https://discuss.circleci.com/c/ecosystem/orbs">我们活跃的orb开发者和用户社区</a>可以帮助解决任何关于这个或任何其他orb的问题。</p>


        
          
          
        
      </div>
    </div>    
</body>
</html>
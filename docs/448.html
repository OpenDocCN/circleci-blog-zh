<html>
<head>
<title>New CircleCI features for secure secrets management | CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用于安全机密管理的新CircleCI功能| CircleCI</h1>
<blockquote>原文：<a href="https://circleci.com/blog/new-features-secure-secrets-management/#2023-02-06T23:00:00-08:00">https://circleci.com/blog/new-features-secure-secrets-management/#2023-02-06T23:00:00-08:00</a></blockquote><div><div class="post-content col-xs-12 col-md-10 col-lg-8">
        

        <p>当安全事故发生时，软件提供商和用户采取迅速有效的行动至关重要。为了应对我们最近的<a href="https://circleci.com/blog/jan-4-2023-incident-report/">安全事件</a>，我们亲眼目睹了我们的客户、技术合作伙伴和工程团队如何通过开放和协作来帮助遏制威胁并降低未经授权访问客户系统的风险。</p>

<p>在本帖中，我们想重点介绍一些我们为应对2023年1月4日的安全事件而推出的新功能和工具。其中包括:</p>
<ul>
  <li>一个交互式CLI工具，用于识别CircleCI中为您的组织项目存储的所有机密</li>
  <li>对CircleCI UI和API进行了更改，以简化机密审计</li>
  <li>全面访问自助审核日志，以查看30天内CircleCI环境的变化。</li>
</ul>

<p>总的来说，这些更新使客户更容易通过我们的UI或API轮换机密，并验证所有受影响的管道和凭据都已得到保护。在许多情况下，这些变化是由我们的社区成员的问题、请求和积极响应激发的，因为他们致力于重置凭据并监控其项目和相关服务的活动。我们感谢您对此事件的贡献和持续支持。</p>

<h2>使用CircleCI-Env-Inspector识别秘密</h2>

<p>CircleCI-Env-Inspector是一个命令行界面(CLI)工具，您可以使用它来生成存储在CircleCI上的所有机密的JSON报告。此工具对于在项目环境变量和组织范围的上下文中拥有大量机密的组织特别有用，因为它提供了需要手动轮换的项目的完整列表。请注意，该工具将只返回姓名和其他识别信息，但<em>不会</em>返回秘密值，这意味着没有意外暴露敏感信息的风险。</p>

<figure>
  <video autoplay="" loop="" muted="" playsinline="">
    <source src="//videos.ctfassets.net/il1yandlcjgk/2KqmeXHsf4Wveib8cGmPHP/28442b569a5fb4a7703e80ea98bc5a50/environment-inspector.mp4" type="video/mp4"/>
  </video>
  <figcaption>Environment inspector</figcaption>
</figure>

<p>要使用Env-Inspector工具，请访问并克隆<a href="https://github.com/CircleCI-Public/CircleCI-Env-Inspector" target="_blank" rel="noreferrer noopener">项目存储库</a>，然后生成一个<a href="https://app.circleci.com/settings/user/tokens"> CircleCI API令牌</a>，它可以访问您想要检查的所有项目。要列出整个组织的所有项目中使用的秘密，您需要从一个组织管理员帐户生成API令牌。</p>

<p>一旦有了API令牌，导航到Env-Inspector存储库的根目录并运行命令<code>run.sh</code>。在提示符下输入您的API令牌，工具将返回存储在项目环境变量和上下文中的所有秘密的列表。下面是一个输出示例:</p>

<pre><code>{
  "contexts": [
    {
      "name": "CONTEXT_NAME",
      "url": "https://app.circleci.com/settings/organization/&lt;VCS&gt;/&lt;ORG&gt;/contexts/&lt;CONTEXT-ID&gt;",
      "id": "xxx",
      "variables": [
        {
          "variable": "GITHUB_TOKEN",
          "context_id": "xxx",
          "created_at": "yyy"
        }
      ]
    }
  ],
  "projects": [
    {
      "name": "ORG/REPO",
      "url": "https://app.circleci.com/settings/project/&lt;VCS&gt;/&lt;ORG&gt;/&lt;REPO&gt;/environment-variables",
      "variables": [{ "name": "VAR", "value": "xxxx" }],
      "project_keys": [
        {
          "type": "deploy-key",
          "preferred": true,
          "created_at": "xxx",
          "public_key": "yyy",
          "fingerprint": "zzz"
        }
          ]
    }
  ]

}

</code></pre>

<p>输出包括几条信息，您可以使用这些信息来识别存储在项目中的机密，包括上下文或项目的名称、URL、ID号以及凭据创建和上次更新的日期和时间。</p>

<p>CircleCI Env-Inspector是一个开源工具，我们欢迎社区以问题或项目存储库请求的形式做出贡献。</p>

<h2>确认机密已经使用<code>updated_at</code>时间戳进行了轮换</h2>

<p>为了让客户放心，他们的长期秘密已经被更改，我们在web应用程序的上下文API、环境变量和上下文管理页面中引入了<code>updated_at</code>时间戳。此信息允许您验证机密是否已成功轮换，并识别任何需要更新的机密。</p>

<p>在API中，<code>updated_at</code>数据在对列出上下文环境变量的<a href="https://circleci.com/docs/api/v2/index.html#operation/listContexts"> <code>GET</code>请求和添加或更新现有上下文变量</a>的<a href="https://circleci.com/docs/api/v2/index.html#operation/addEnvironmentVariableToContext"> <code>PUT</code>请求的响应中提供。以下是对上下文API的更新请求的示例响应:</a></p>

<pre><code>{
  "variable" : "a_variable",
  "updated_at" : "2023-01-09T20:32:18.568Z",
  "context_id" : "b5a5561a-7159-48f1-854f-1e53a8f315e0",
  "created_at" : "2023-01-09T20:26:57.020Z"
}

</code></pre>

<p>响应包括变量的名称、更新的日期和时间、存储变量的上下文的ID号以及变量更新的原始日期和时间。</p>

<p>对于喜欢通过web应用程序更新秘密的用户，我们还更新了我们的上下文UI，以提供关于变量何时创建和上次更新的信息。</p>

<p><img src="../Images/a6c656ac12da6a94ceb911880983674a.png" alt="Environment variables list" srcset="https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://ctf-cci-com.imgix.net/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://images.ctfassets.net/il1yandlcjgk/8blEs9RoQwx0yW7GSHEsN/374c66f0a53caa646bceb202de7b703c/2023-02-01-security-toolkit-image2.png"/></p>

<p>要查看贵组织的上下文环境变量，请访问<strong>组织设置&gt;上下文</strong>。</p>

<h2>将SSH检出密钥与SHA256指纹进行比较</h2>

<p>作为我们对客户的补救指导的一部分，我们建议在CircleCI和您的目标环境中轮换所有SSH密钥。为了让您更容易地跨系统比较签出密钥，我们添加了从我们的v1.1 API返回SHA-256公钥指纹的能力。这是对返回MD5指纹的现有能力的补充。</p>

<p>下面是检索阿沙-256标识符的API调用示例:</p>

<pre><code>curl -H “Circle-Token: " https://circleci.com/api/v1.1/project/:vcs-type/:username/:project/checkout-key?digest=sha256
</code></pre>

<p><code>?digest=sha256</code>查询参数指定响应将返回结帐键的SHA-256散列。</p>

<p>有关旋转SSH密钥的更多信息，请访问我们的<a href="https://support.circleci.com/hc/en-us/articles/12015682624667-Best-Practices-for-Rotating-User-SSH-keys-and-Additional-SSH-keys">支持文章</a>。</p>

<h2>使用自助审计日志审查CircleCI环境中的活动</h2>

<p>为了帮助客户审计和分析其组织下的活动，CircleCI在审计日志中记录重要的系统事件。客户可以通过两种方式访问这些日志:</p>

<ol>
  <li>通过请求客户支持</li>
  <li>直接从web应用程序中的自助服务门户</li>
</ol>

<p>传统上，自助审核日志仅向我们的规模、性能和服务器计划的客户提供。为了帮助所有客户保护他们的系统，我们暂时扩展了自助服务功能，将客户纳入我们的免费计划。</p>

<p>用户可以通过访问<strong>组织设置&gt;安全</strong>并选择一个日期范围来请求在之前365天中任何30天期间的系统活动日志。免费计划的客户每天可以请求一个审计日志，而付费计划的客户每天最多可以请求三个日志。</p>

<p><img src="../Images/093f995c8f64b90c4fb0116a41ba730e.png" alt="Audit logs" srcset="https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://ctf-cci-com.imgix.net/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://images.ctfassets.net/il1yandlcjgk/MsZJ9P1iBuPC0kNXv8Sdz/c52e2b858a6b2f34eb2a6a42df35483d/2023-02-01-security-toolkit-image1.png"/></p>

<p>CircleCI审计日志记录重要的系统活动，比如创建或删除上下文、项目环境变量、SSH密钥或API令牌；工作流作业开始、完成或批准的时间；和对预定流水线的改变。这些日志包括以下数据:采取操作的时间、启动操作的用户、受操作影响的实体(组织、项目、帐户或版本)以及操作是否成功。</p>

<p>请注意，虽然查看您的CircleCI审计日志是确保CI/CD环境中没有发生未授权活动的重要步骤，但我们强烈建议您也查看2022年12月21日至2023年1月4日期间您的构建流程中使用的所有连接服务的审计日志。</p>

<h2>结论</h2>

<p>这篇文章中强调的新功能和更新是由我们的工程团队制作的，以立即帮助客户应对1月4日的安全事件。但是，定期轮换静态凭据是一种安全最佳实践，我们鼓励您继续将这些功能作为日常安全工作的一部分。保护管道安全的其他步骤包括:</p>


<p>我们感谢我们的客户在保持管道安全方面的持续合作和警惕，我们的团队将随时为您提供支持。如果您对事件、我们的持续响应或我们对客户的建议有任何疑问，请访问我们完整的<a href="https://circleci.com/blog/jan-4-2023-incident-report/">事件报告</a>或联系<a href="https://support.circleci.com/hc/en-us">客户支持</a>。</p>


        
          
          
        
      </div>
    </div>    
</body>
</html>
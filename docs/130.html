<html>
<head>
<title>Continuous integration with GitOps | CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>与GitOps | CircleCI的持续集成</h1>
<blockquote>原文：<a href="https://circleci.com/blog/ci-with-gitops/#2021-05-10T13:00:00-07:00">https://circleci.com/blog/ci-with-gitops/#2021-05-10T13:00:00-07:00</a></blockquote><div><div class="post-content col-xs-12 col-md-10 col-lg-8">
        

        <p>软件开发日新月异。一方面，您必须快速适应不断发展的需求，而另一方面，您的应用程序需要连续运行而不停机。</p>

<p>DevOps帮助你快速适应变化。在其他计划中，<a href="https://circleci.com/continuous-integration/">持续集成</a> (CI)和<a href="https://martinfowler.com/bliki/ContinuousDelivery.html">持续交付</a> (CD)对于任何DevOps实践都是不可或缺的。</p>

<p>使用CI，开发人员可以通过自动化构建和测试将他们的代码与其他人的代码合并。开发人员将他们的代码提交给源代码控制系统，通常是Git。代码提交触发了自动化构建操作，随后是单元测试。新代码然后合并到主分支中。在增量代码更改后，您可以在构建和测试时快速修复任何问题。这也有助于解决任何问题，包括合并冲突和棘手的bug，因为您是在小步骤中集成代码库的。</p>

<p>如果测试套件已经通过，连续交付可以让您在构建之后立即部署应用程序。<strong>您可以适应快速变化的需求，并确保应用程序在最短的停机时间内运行。</strong></p>

<p>虽然DevOps在开发和部署软件方面非常有用，但是结合使用Git和CI/CD在软件工程领域之外也非常有用。将这些原则应用于非软件工作的想法被称为GitOps。</p>

<p>GitOps最常见的用途之一是使用基础设施即代码(IaC)工具供应云基础设施。</p>

<h2>将GitOps与IaC一起使用</h2>

<p>如上所述，DevOps工作流旨在构建和部署软件。但是在DevOps可以工作之前，我们需要一个部署软件的地方。<strong>应用需要包含计算、存储和网络服务的环境。</strong>在开发生命周期中，您会使用许多环境，例如开发、试运行和生产。传统上，每个环境都有其配置，通常会随着时间的推移而变化，从而导致所谓的环境漂移。此后，配置无法自动复制，导致难以跟踪的错误，并需要手动维护。</p>

<p>要解决这个问题，您可以使用基础结构作为代码(IaC)。通过IaC，您可以使用Terraform、CloudFormation和Azure Resource Manager模板等工具创建您想要的基础设施的声明，然后将该声明保存在Git存储库中。通过这样做，您可以遵循开发人员对其代码使用的相同方法。更改基础结构声明后，您将更新的文件提交到存储库中。这将触发CI/CD管道来验证配置，然后运行自动化工具来配置或停用基础架构资源。</p>

<p>然后，您可以将Git工作流用于基础设施部署。例如，您可以创建一个新的Git分支，在那里您可以使用环境声明文件。完成后，您将创建一个拉取请求。然后，您的更改将被审核，审核通过后，分支将被合并到主分支中。如果CI/CD系统正在监视存储库，合并将触发自动化的基础架构部署。</p>

<p>您甚至可以扩展GitOps IaC方法来管理Kubernetes用于配置的JSON或YAML文件。通过修改和部署这些文件，您可以自动执行集群中容器的滚动更新，本质上是使用GitOps来部署应用程序。在这种情况下，您只需要更改配置文件并将其推送到Git存储库。然后，CI/CD系统会自动将更改部署到集群中。更具体地说，CI/CD系统使用适当的命令行界面(CLI ),如kubectl，来应用您提交的更改。</p>

<p>在实践中，您设置了一个包含各种作业的构建和部署管道。每个作业由一个或多个步骤组成。第一个作业可以提供资源。例如，它可以自动为您创建或更新Kubernetes集群。同样，该作业使用CLI脚本来调配资源。假设环境已经准备好，第二个作业可以检查源代码，构建源代码，并将应用程序部署到环境中。</p>

<h2>使用GitOps的持续集成——一个例子</h2>

<p>下面是使用CircleCI设置管道的步骤。我们将创建包含两个作业的管道。第一项工作将在Azure中部署托管的Kubernetes集群。第二项工作是将容器化的ASP.NET 5应用程序部署到该集群。</p>

<h2>添加存储库</h2>

<p>我们首先创建GitHub存储库，<a href="https://github.com/dawidborycki/CircleCI-AKS-GitOps"> CircleCI-AKS-GitOps </a>。为了简单起见，我们只有一个主分支，在k8s文件夹下有all-in-one.yml文件(见下图)。该文件包含部署和服务声明。部署将使用Docker映像和示例【ASP.NET 5】应用创建两个pod。这两个pod都将使用负载平衡器服务向公众公开。我们将在部署后获得该服务的公共IP。</p>

<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: aspnet-sample-app
spec:
  selector:
      matchLabels:
        app: aspnet-sample-app
  replicas: 2
  template:
      metadata:
        labels:
            app: aspnet-sample-app
      spec:
        containers:
        - name: aspnet-sample-app-pod
          image: mcr.microsoft.com/dotnet/samples:aspnetapp 
          ports:
          - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: aspnet-sample-app-svc  
spec:
  selector:
    app: aspnet-sample-app
  type: LoadBalancer
  pxorts:
  - port: 80
</code></pre>

<h2>创建管道</h2>

<p>要将这个存储库与CI/CD系统连接起来，您需要管道配置。这是一个包含作业和步骤声明的YAML文件。使用CircleCI时，可以在config.yml文件的。circleci文件夹。</p>

<p>这里，我们使用orb为Azure Kubernetes服务和Kubernetes创建config.yml:</p>

<pre><code>jobs:
  create-deployment:
    executor: azure-aks/default
    parameters:
      cluster-name:
        description: |
          Name of the AKS cluster
        type: string
      resource-group: 
        description: |
          Resource group that the cluster is in
        type: string
    steps:
      - checkout
      - azure-aks/update-kubeconfig-with-credentials:
          cluster-name: &lt;&lt; parameters.cluster-name &gt;&gt;
          install-kubectl: true
          perform-login: true
          resource-group: &lt;&lt; parameters.resource-group &gt;&gt;
      - kubernetes/create-or-update-resource:
          resource-file-path: k8s/all-in-one.yml
          resource-name: deployment/dotnet-deployment
orbs:
  azure-aks: circleci/azure-aks@0.2.1
  kubernetes: circleci/kubernetes@0.4.0
version: 2.1
workflows:
  deployment:
    jobs:
      - azure-aks/create-cluster:
          cluster-name: aks-dotnet
          create-resource-group: true
          generate-ssh-keys: true
          location: eastus
          resource-group: aks-dotnet-rg         
      - create-deployment:
          cluster-name: aks-dotnet
          requires:
            - azure-aks/create-cluster
          resource-group: aks-dotnet-rg                          
</code></pre>

<p>有两种工作:</p>
<ul>
  <li>azure-aks/create-cluster–使用AKS创建Kubernetes集群</li>
  <li>创建-部署–将all-in-one.yml Kubernetes配置应用于AKS集群</li>
</ul>

<p>作业具有附加参数，使您能够应用其他配置。在这里，我们使用它们来设置集群名称(aks-dotnet)、区域(eastus)和Azure资源组(aks-dotnet-rg)。</p>

<h2>CircleCI的建筑</h2>

<p>一旦我们配置了管道，我们就可以在CircleCI中查看项目。如果使用GitHub或Bitbucket，可以使用现有账户在CircleCI注册。该服务将自动发现您的存储库。</p>

<p><img src="../Images/d08cc4bec5db4c1717f8875bd4f7eb58.png" alt="CircleCI project page" srcset="https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-01.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2021-05-10-ci-with-gitops-01.png"/></p>

<p>然后，使用“设置项目”按钮创建新的配置文件或选择现有的管道配置。对于这个例子，我们使用config.yml。之后，CircleCI将开始构建项目。</p>

<p><img src="../Images/bed429dc0c39e0b0eae748a47e06ae31.png" alt="CircleCI pipeline" srcset="https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-02.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2021-05-10-ci-with-gitops-02.png"/></p>

<p><img src="../Images/a8c87fd6604ca6298039cee05a984f5e.png" alt="CircleCI pipeline details" srcset="https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-03.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2021-05-10-ci-with-gitops-03.png"/></p>

<p>要成功连接到Azure，您必须使用项目环境变量提供用户凭据或服务主体。我们的用户凭据存储在我们在项目设置中键入的AZURE_USERNAME和AZURE_PASSWORD下。</p>

<p><img src="../Images/e59a873e9d0a1a8fdae5c0961594ae1b.png" alt="CircleCI environment variables" srcset="https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-04.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2021-05-10-ci-with-gitops-04.png"/></p>

<p>设置完这些变量后，CircleCI将为您创建AKS集群，然后部署应用程序。请注意，第一个管道由于缺少凭据而失败。</p>

<p><img src="../Images/4118b18a1c58f42f523291024c9ab3ae.png" alt="CircleCI failed pipeline" srcset="https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-05.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2021-05-10-ci-with-gitops-05.png"/></p>

<h2>测试资源</h2>

<p>我们现在可以测试部署了。为此，我们登录Azure门户，打开Azure CloudShell，然后调用以下命令:</p>

<pre><code>az aks list -o table
</code></pre>

<p>这个命令将显示所有AKS集群的列表，包括我们通过CircleCI部署的那个(aks-dotnet)。现在，我们需要登录到该集群，并读取负载平衡器服务的公共IP。为此，调用以下命令:</p>

<pre><code>az aks get-credentials -n aks-dotnet -g aks-dotnet-rg
kubectl get svc
</code></pre>
<p>我们的应用程序的IP出现在外部IP列中。使用此地址查看正在运行的应用。</p>

<p><img src="../Images/36e75d9390a4a5569b31127f6833f726.png" alt="Kubernetes services" srcset="https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=449 449w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=898 898w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1347 1347w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=720 720w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1440 1440w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2160 2160w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=779 779w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1558 1558w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2337 2337w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=750 750w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=1500 1500w,&#10;https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;w=2250 2250w" sizes="(min-width: 1200px) 750px,&#10;(min-width: 992px) 779px,&#10;(min-width: 768px) 720px,&#10;(min-width: 480px) 720px,&#10;(min-width: 0px) 449px" data-full-size-src="https://production-cci-com.imgix.net/blog/media/2021-05-10-ci-with-gitops-06.png?ixlib=rb-3.2.1&amp;auto=format&amp;fit=max&amp;q=60&amp;ch=DPR%2CWidth%2CViewport-Width%2CSave-Data&amp;fm=jpg" data-original-src="https://circleci.com/blog/media/2021-05-10-ci-with-gitops-06.png"/></p>

<h3>清理资源</h3>

<p>要清理资源，请键入:</p>

<pre><code>az group delete -n aks-dotnet-rg --no-wait --yes
</code></pre>

<p>这将删除AKS集群而无需确认。或者，您可以用另一个自动删除集群的作业来补充管道。</p>

<h2>总结和后续步骤</h2>

<p>我们刚刚学习了如何使用CircleCI和GitHub存储库将容器化的应用程序部署到托管的Kubernetes集群。在实践中，您将使用另一个Git分支来补充上述工作流，并创建pull请求，以便其他人可以查看您所做的更改。</p>

<p>如果您已经在使用CI/CD系统，有很好的[迁移文档]https://circleci . com/docs/migration-intro/# section = getting-started帮助您将项目迁移到circle CI。</p>

<p>在这些知识的推动下，您现在可以开始使用CirlceCI构建您的GitOps工作流，轻松管理应用程序并腾出时间专注于新功能。您可以马上开始，今天就注册您的<a href="https://circleci.com/signup/"> CircleCI免费试用</a>。</p>


        
          
          
        
      </div>
    </div>    
</body>
</html>